package com.google.firebase.samples.apps.mlkit.java;

import android.content.Intent;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.content.ContextCompat;

import android.content.Context;
import android.content.Intent;
import android.graphics.Bitmap;
import android.graphics.Canvas;
import android.graphics.drawable.Drawable;
import android.location.Location;
import android.media.FaceDetector;
import android.os.Bundle;
import android.speech.tts.TextToSpeech;
import android.util.Log;
import android.view.View;
import android.widget.CompoundButton;
import android.widget.Toast;

import com.android.volley.DefaultRetryPolicy;
import com.android.volley.Request;
import com.android.volley.RequestQueue;
import com.android.volley.Response;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.StringRequest;
import com.android.volley.toolbox.Volley;
import com.google.android.gms.location.FusedLocationProviderClient;
import com.google.android.gms.location.LocationServices;
import com.google.android.gms.maps.CameraUpdateFactory;
import com.google.android.gms.maps.GoogleMap;
import com.google.android.gms.maps.MapView;
import com.google.android.gms.maps.OnMapReadyCallback;
import com.google.android.gms.maps.SupportMapFragment;
import com.google.android.gms.maps.model.BitmapDescriptor;
import com.google.android.gms.maps.model.BitmapDescriptorFactory;
import com.google.android.gms.maps.model.LatLng;
import com.google.android.gms.maps.model.LatLngBounds;
import com.google.android.gms.maps.model.Marker;
import com.google.android.gms.maps.model.MarkerOptions;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.firebase.samples.apps.mlkit.R;
import com.google.firebase.samples.apps.mlkit.common.CameraSource;
import com.google.firebase.samples.apps.mlkit.common.CameraSourcePreview;
import com.google.firebase.samples.apps.mlkit.common.GraphicOverlay;
import com.google.firebase.samples.apps.mlkit.java.facedetection.FaceContourDetectorProcessor;
import com.mikepenz.materialdrawer.Drawer;
import com.mikepenz.materialdrawer.DrawerBuilder;
import com.mikepenz.materialdrawer.model.PrimaryDrawerItem;
import com.mikepenz.materialdrawer.model.interfaces.IDrawerItem;
import com.mikepenz.materialdrawer.model.PrimaryDrawerItem;
import com.mikepenz.materialdrawer.model.interfaces.IDrawerItem;
import com.mikepenz.materialdrawer.model.SwitchDrawerItem;
import com.mikepenz.materialdrawer.model.ToggleDrawerItem;
import com.mikepenz.octicons_typeface_library.Octicons;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import org.w3c.dom.Text;

import java.io.IOException;
import java.net.URLEncoder;
import java.util.ArrayList;
import java.util.Locale;
import java.util.Timer;
import java.util.TimerTask;

public class MapActivity extends AppCompatActivity implements OnMapReadyCallback, GoogleMap.OnMyLocationButtonClickListener {
    private final String TAG = "MapActivity";

    private GoogleMap mMap;
    private RequestQueue queue;
    private FusedLocationProviderClient fusedLocationClient;

    private LatLng mCurrentLocation = null;
    private LatLng mLastLocation = null;

    private ArrayList<Marker> intersections = new ArrayList<>();
    private ArrayList<Marker> turns = new ArrayList<>();
    private Marker approaching = null;
    private boolean reachedIntersection = false;
    private double enterIntersectionTime = 0;

    private double[][] demoRoute = {{43.0094622, -81.2727524}, {43.00940767127894, -81.27277091626475}, {43.00935314255788, -81.27278943252948}, {43.00929861383682, -81.27280794879422}, {43.00924408511575, -81.27282646505897}, {43.009189556394695, -81.27284498132371}, {43.009135027673636, -81.27286349758845}, {43.00908049895257, -81.27288201385319}, {43.00902597023151, -81.27290053011792}, {43.00897144151045, -81.27291904638267}, {43.00891691278939, -81.2729375626474}, {43.00886238406833, -81.27295607891215}, {43.00880785534727, -81.27297459517689}, {43.008753326626206, -81.27299311144162}, {43.00869879790514, -81.27301162770637}, {43.00864426918408, -81.27303014397111}, {43.00858974046302, -81.27304866023584}, {43.00853521174196, -81.2730671765006}, {43.008480683020906, -81.27308569276533}, {43.00842615429984, -81.27310420903008}, {43.008371625578775, -81.27312272529483}, {43.008317096857716, -81.27314124155956}, {43.00826256813666, -81.2731597578243}, {43.00820803941559, -81.27317827408905}, {43.00815351069454, -81.27319679035378}, {43.008098981973475, -81.27321530661852}, {43.00804445325242, -81.27323382288326}, {43.00798992453135, -81.273252339148}, {43.00793539581029, -81.27327085541275}, {43.007880867089234, -81.27328937167749}, {43.00782633836817, -81.27330788794224}, {43.007773, -81.273326}, {43.00771582369109, -81.27333286317565}, {43.007658647382186, -81.2733397263513}, {43.007601471073265, -81.27334658952695}, {43.00754429476436, -81.2733534527026}, {43.00748711845545, -81.27336031587825}, {43.007429942146544, -81.2733671790539}, {43.00737276583763, -81.27337404222955}, {43.00731558952872, -81.27338090540519}, {43.007258413219816, -81.27338776858085}, {43.0072012369109, -81.2733946317565}, {43.007144060601995, -81.27340149493216}, {43.00708688429309, -81.27340835810779}, {43.007029707984174, -81.27341522128344}, {43.00697253167527, -81.2734220844591}, {43.00691535536636, -81.27342894763476}, {43.006858179057446, -81.2734358108104}, {43.00680100274854, -81.27344267398604}, {43.00674382643963, -81.2734495371617}, {43.006686650130725, -81.27345640033735}, {43.00664, -81.273462}, {43.006630659570746, -81.27340517579862}, {43.0066213191415, -81.27334835159725}, {43.00661197871224, -81.27329152739587}, {43.006602638283, -81.27323470319449}, {43.006593297853755, -81.27317787899312}, {43.0065839574245, -81.27312105479174}, {43.00657461699525, -81.27306423059036}, {43.006565276566, -81.273007406389}, {43.00655593613675, -81.27295058218762}, {43.006546595707505, -81.27289375798624}, {43.00653725527826, -81.27283693378487}, {43.006527914849, -81.2727801095835}, {43.00651857441976, -81.27272328538211}, {43.006509233990506, -81.27266646118073}, {43.006499893561255, -81.27260963697935}, {43.00649055313201, -81.27255281277799}, {43.00648121270276, -81.27249598857662}, {43.00647187227351, -81.27243916437524}, {43.00646253184426, -81.27238234017386}, {43.00645319141501, -81.27232551597248}, {43.00644385098576, -81.2722686917711}, {43.00643451055651, -81.27221186756974}, {43.00642517012726, -81.27215504336836}, {43.006415829698014, -81.27209821916699}, {43.00640648926877, -81.27204139496561}, {43.00639714883951, -81.27198457076423}, {43.00638780841027, -81.27192774656285}, {43.00637846798101, -81.27187092236149}, {43.006369127551764, -81.2718140981601}, {43.00635978712252, -81.27175727395874}, {43.00635044669327, -81.27170044975736}, {43.00634110626402, -81.27164362555598}, {43.006331765834766, -81.2715868013546}, {43.006322425405514, -81.27152997715324}, {43.00631308497627, -81.27147315295186}, {43.00630374454702, -81.27141632875048}, {43.00629440411777, -81.2713595045491}, {43.00628506368852, -81.27130268034773}, {43.00627572325927, -81.27124585614635}, {43.00626638283002, -81.27118903194497}, {43.00625704240077, -81.27113220774359}, {43.00624770197152, -81.27107538354224}, {43.00623836154227, -81.27101855934086}, {43.00622902111302, -81.27096173513948}, {43.00621968068378, -81.2709049109381}, {43.006210340254526, -81.27084808673673}, {43.00620099982528, -81.27079126253535}, {43.00619165939603, -81.27073443833397}, {43.00618231896678, -81.2706776141326}, {43.00617297853753, -81.27062078993123}, {43.00616363810828, -81.27056396572985}, {43.006162, -81.270554}, {43.00621650931199, -81.2705354266754}, {43.00627101862398, -81.27051685335078}, {43.006325527935964, -81.27049828002615}, {43.00638003724795, -81.27047970670154}, {43.00643454655994, -81.27046113337693}, {43.006489055871924, -81.2704425600523}, {43.006543565183904, -81.27042398672769}, {43.0065980744959, -81.27040541340308}, {43.006652583807885, -81.27038684007847}, {43.00670709311987, -81.27036826675385}, {43.00676160243186, -81.27034969342924}, {43.006816111743845, -81.27033112010461}, {43.006870621055825, -81.27031254678}, {43.00692513036782, -81.27029397345538}, {43.0069796396798, -81.27027540013077}, {43.00703414899179, -81.27025682680616}, {43.00708865830377, -81.27023825348155}, {43.007143167615766, -81.27021968015693}, {43.007197676927746, -81.27020110683232}, {43.00725218623974, -81.2701825335077}, {43.00730669555172, -81.27016396018308}, {43.007361204863706, -81.27014538685847}, {43.00741571417569, -81.27012681353385}, {43.00747022348768, -81.27010824020924}, {43.007524732799666, -81.27008966688462}, {43.00757924211165, -81.27007109356}, {43.00763375142364, -81.2700525202354}, {43.007688260735634, -81.27003394691079}, {43.007742770047614, -81.27001537358615}, {43.0077972793596, -81.26999680026154}, {43.00785178867159, -81.26997822693693}, {43.007906297983574, -81.2699596536123}, {43.00796080729556, -81.2699410802877}, {43.008008, -81.269925}, {43.007999812897324, -81.26986799820327}, {43.007991625794645, -81.26981099640655}, {43.007983438691966, -81.26975399460981}, {43.007975251589286, -81.26969699281308}, {43.007967064486614, -81.26963999101636}, {43.00795887738394, -81.26958298921964}, {43.00795069028126, -81.2695259874229}, {43.0079425031786, -81.26946898562616}, {43.00793431607592, -81.26941198382944}, {43.00792612897324, -81.26935498203272}, {43.00791794187056, -81.26929798023599}, {43.00790975476789, -81.26924097843926}, {43.00790156766521, -81.26918397664252}, {43.007893380562535, -81.2691269748458}, {43.007885193459856, -81.26906997304907}, {43.007877006357184, -81.26901297125234}, {43.00786881925451, -81.26895596945562}, {43.00786063215183, -81.26889896765888}, {43.00785244504915, -81.26884196586215}, {43.00784425794648, -81.26878496406543}, {43.00783607084381, -81.2687279622687}, {43.00782788374113, -81.26867096047198}, {43.00781969663845, -81.26861395867523}, {43.00781150953577, -81.26855695687851}, {43.007803322433105, -81.26849995508178}, {43.007795135330426, -81.26844295328505}, {43.007786948227746, -81.26838595148831}, {43.00777876112507, -81.2683289496916}, {43.007770574022395, -81.26827194789487}, {43.00776238691972, -81.26821494609814}, {43.00775419981704, -81.26815794430141}, {43.007746012714364, -81.26810094250469}, {43.00773782561169, -81.26804394070795}, {43.00772963850902, -81.26798693891124}, {43.00772145140634, -81.2679299371145}, {43.00771326430366, -81.26787293531777}, {43.00770507720099, -81.26781593352105}, {43.00769689009831, -81.26775893172432}, {43.00768870299564, -81.26770192992758}, {43.00768051589296, -81.26764492813086}, {43.007672328790285, -81.26758792633413}, {43.00766414168761, -81.2675309245374}, {43.007655954584926, -81.26747392274066}, {43.007647767482254, -81.26741692094394}, {43.00763958037958, -81.26735991914721}, {43.00763139327691, -81.26730291735048}, {43.00762320617423, -81.26724591555376}, {43.00761501907155, -81.26718891375702}, {43.00760683196887, -81.26713191196029}, {43.0075986448662, -81.26707491016357}, {43.00759045776353, -81.26701790836684}, {43.007582270660855, -81.2669609065701}, {43.00757408355817, -81.26690390477339}, {43.007565896455496, -81.26684690297665}, {43.007557709352824, -81.26678990117992}, {43.007556, -81.266778}, {43.00756368536732, -81.26675025124328}, {43.007571370734645, -81.26672250248659}, {43.00757905610197, -81.26669475372987}, {43.00758674146929, -81.26666700497314}, {43.00759442683661, -81.26663925621642}, {43.007602112203934, -81.26661150745971}, {43.007609797571256, -81.26658375870299}, {43.00761748293858, -81.26655600994627}, {43.0076251683059, -81.26652826118956}, {43.00763285367322, -81.26650051243286}, {43.007640539040544, -81.26647276367613}, {43.007648224407866, -81.26644501491943}, {43.00765590977518, -81.26641726616269}, {43.0076635951425, -81.26638951740598}, {43.007671280509825, -81.26636176864928}, {43.007678965877155, -81.26633401989255}, {43.00768665124448, -81.26630627113583}, {43.007694336611806, -81.26627852237912}, {43.00770202197913, -81.26625077362242}, {43.00770970734645, -81.2662230248657}, {43.00771739271377, -81.26619527610897}, {43.00772507808109, -81.26616752735227}, {43.00773276344841, -81.26613977859554}, {43.00774044881573, -81.26611202983882}, {43.00774813418305, -81.26608428108212}, {43.007755819550376, -81.2660565323254}, {43.0077635049177, -81.26602878356869}, {43.00777119028503, -81.26600103481196}, {43.00777887565235, -81.26597328605526}, {43.00778656101967, -81.26594553729853}, {43.007794246386986, -81.26591778854183}, {43.00780193175431, -81.26589003978512}, {43.00780961712163, -81.2658622910284}, {43.00781730248895, -81.26583454227168}, {43.007824987856274, -81.26580679351495}, {43.0078326732236, -81.26577904475825}, {43.00784035859092, -81.26575129600153}, {43.00784804395824, -81.26572354724482}, {43.00785572932556, -81.2656957984881}, {43.007863414692885, -81.26566804973139}, {43.00787110006021, -81.26564030097467}, {43.00787878542753, -81.26561255221796}, {43.00788647079485, -81.26558480346124}, {43.00789415616217, -81.26555705470452}, {43.007901841529495, -81.26552930594781}, {43.007909526896825, -81.26550155719109}, {43.00791721226415, -81.26547380843438}, {43.00792489763147, -81.26544605967766}, {43.00793258299879, -81.26541831092095}, {43.00794026836611, -81.26539056216423}, {43.00794795373343, -81.2653628134075}, {43.00795563910075, -81.2653350646508}, {43.00796332446807, -81.26530731589409}, {43.007971009835394, -81.26527956713737}, {43.007978695202716, -81.26525181838065}, {43.00798638057004, -81.26522406962394}, {43.00799406593736, -81.26519632086722}, {43.00800175130468, -81.26516857211051}, {43.008009436672005, -81.26514082335379}, {43.008017122039334, -81.26511307459708}, {43.00802480740665, -81.26508532584036}, {43.00803249277397, -81.26505757708364}, {43.00804017814129, -81.26502982832693}, {43.008047863508615, -81.26500207957021}, {43.00805554887594, -81.26497433081349}, {43.00806323424326, -81.26494658205678}, {43.00807091961058, -81.26491883330007}, {43.008078604977904, -81.26489108454335}, {43.00808629034523, -81.26486333578664}, {43.00809397571255, -81.26483558702992}, {43.00810166107987, -81.26480783827321}, {43.00810934644719, -81.26478008951649}, {43.008117031814514, -81.26475234075977}, {43.008124717181836, -81.26472459200306}, {43.00813240254916, -81.26469684324634}, {43.00814008791648, -81.26466909448962}, {43.0081477732838, -81.26464134573291}, {43.00815545865113, -81.2646135969762}, {43.008163144018454, -81.26458584821948}, {43.008170829385776, -81.26455809946276}, {43.0081785147531, -81.26453035070605}, {43.00818620012041, -81.26450260194933}, {43.008193885487735, -81.26447485319261}, {43.00820157085506, -81.2644471044359}, {43.00820925622238, -81.2644193556792}, {43.0082169415897, -81.26439160692247}, {43.00822462695703, -81.26436385816575}, {43.00823231232435, -81.26433610940904}, {43.008239997691675, -81.26430836065234}, {43.008247683059, -81.26428061189561}, {43.00825536842632, -81.26425286313889}, {43.008263053793634, -81.26422511438219}, {43.008270739160956, -81.26419736562546}, {43.00827842452828, -81.26416961686874}, {43.0082861098956, -81.26414186811203}, {43.00829379526293, -81.26411411935533}, {43.00830148063025, -81.26408637059859}, {43.008309165997574, -81.26405862184188}, {43.008316851364896, -81.26403087308518}, {43.00832453673222, -81.26400312432847}, {43.00833222209954, -81.26397537557173}, {43.008339907466855, -81.26394762681502}, {43.00834759283418, -81.26391987805832}, {43.0083552782015, -81.2638921293016}, {43.00836296356883, -81.26386438054487}, {43.00837064893615, -81.26383663178817}, {43.00837833430347, -81.26380888303146}, {43.008386019670795, -81.26378113427472}, {43.00839370503812, -81.26375338551802}, {43.00840139040544, -81.26372563676131}, {43.008409075772754, -81.26369788800459}, {43.008416761140076, -81.26367013924786}, {43.0084244465074, -81.26364239049116}, {43.00843213187473, -81.26361464173445}, {43.00843981724205, -81.26358689297773}, {43.00844750260937, -81.263559144221}, {43.00845518797669, -81.2635313954643}, {43.008462873344016, -81.26350364670758}, {43.00847055871134, -81.26347589795085}, {43.00847824407866, -81.26344814919415}, {43.008485929445975, -81.26342040043744}, {43.0084936148133, -81.26339265168072}, {43.008501300180626, -81.263364902924}, {43.00850898554794, -81.26333715416729}, {43.00851667091526, -81.26330940541057}, {43.00852435628259, -81.26328165665386}, {43.008532041649914, -81.26325390789714}, {43.00853972701724, -81.26322615914043}, {43.00854741238456, -81.26319841038371}, {43.008555097751874, -81.26317066162699}, {43.008562783119196, -81.26314291287028}, {43.00857046848652, -81.26311516411356}, {43.00857815385384, -81.26308741535684}, {43.00858583922116, -81.26305966660013}, {43.00859352458849, -81.26303191784342}, {43.00860120995581, -81.2630041690867}, {43.008608895323135, -81.26297642032999}, {43.00861658069046, -81.26294867157327}, {43.00862426605778, -81.26292092281655}, {43.008631951425095, -81.26289317405984}, {43.00863963679242, -81.26286542530312}, {43.00864732215974, -81.26283767654641}, {43.00865500752706, -81.26280992778969}, {43.00866269289439, -81.26278217903297}, {43.00867037826171, -81.26275443027626}, {43.008678063629034, -81.26272668151955}, {43.00868574899635, -81.26269893276283}, {43.00869343436367, -81.26267118400611}, {43.00870111973099, -81.2626434352494}, {43.008708805098316, -81.26261568649268}, {43.00871649046564, -81.26258793773597}, {43.00872417583296, -81.26256018897925}, {43.00873186120029, -81.26253244022254}, {43.00873954656761, -81.26250469146582}, {43.00874723193493, -81.26247694270911}, {43.008754917302255, -81.26244919395239}, {43.00876260266958, -81.26242144519568}, {43.0087702880369, -81.26239369643896}, {43.00877797340422, -81.26236594768224}, {43.008785658771544, -81.26233819892552}, {43.008793344138866, -81.26231045016883}, {43.00880102950619, -81.2622827014121}, {43.00880871487351, -81.26225495265538}, {43.008816400240825, -81.26222720389866}, {43.00882408560815, -81.26219945514194}, {43.00883177097547, -81.26217170638525}, {43.00883945634279, -81.26214395762852}, {43.00884714171011, -81.2621162088718}, {43.008854827077435, -81.2620884601151}, {43.00886251244476, -81.26206071135837}, {43.00887019781208, -81.26203296260165}, {43.00887788317941, -81.26200521384494}, {43.00888556854673, -81.26197746508824}, {43.00889325391405, -81.26194971633151}, {43.008900939281375, -81.26192196757479}, {43.0089086246487, -81.26189421881807}, {43.00891631001602, -81.26186647006138}, {43.00892399538334, -81.26183872130466}, {43.00893168075066, -81.26181097254793}, {43.008939366117986, -81.26178322379121}, {43.00894705148531, -81.2617554750345}, {43.00895473685263, -81.26172772627778}, {43.008962422219945, -81.26169997752108}, {43.00897010758727, -81.26167222876437}, {43.00897779295459, -81.26164448000765}, {43.00898547832191, -81.26161673125092}, {43.00899316368923, -81.2615889824942}, {43.009000849056555, -81.26156123373751}, {43.00900853442388, -81.26153348498079}, {43.0090162197912, -81.26150573622407}, {43.00902390515853, -81.26147798746734}, {43.00903159052585, -81.26145023871064}, {43.00903927589317, -81.26142248995392}, {43.009046961260495, -81.26139474119721}, {43.00905464662782, -81.26136699244049}, {43.00906233199514, -81.26133924368378}, {43.009066, -81.261326}, {43.009058122940445, -81.26131759754368}, {43.0090502458809, -81.26130919508738}, {43.00904236882134, -81.26130079263108}, {43.00903449176179, -81.26129239017476}, {43.00902661470224, -81.26128398771844}, {43.00901873764269, -81.26127558526214}, {43.00901086058313, -81.26126718280582}, {43.00900298352359, -81.26125878034952}, {43.008995106464035, -81.2612503778932}, {43.00898722940448, -81.2612419754369}, {43.00897935234494, -81.26123357298059}, {43.00897147528538, -81.26122517052427}, {43.00896359822583, -81.26121676806797}, {43.008955721166274, -81.26120836561165}, {43.00894784410672, -81.26119996315533}, {43.008939967047176, -81.26119156069905}, {43.008932089987624, -81.26118315824273}, {43.008924212928065, -81.26117475578641}, {43.00891633586852, -81.2611663533301}, {43.00890845880897, -81.26115795087378}, {43.008900581749415, -81.26114954841749}, {43.00889270468986, -81.26114114596118}, {43.00888482763031, -81.26113274350486}, {43.00887695057076, -81.26112434104854}, {43.00886907351121, -81.26111593859224}, {43.00886119645166, -81.26110753613594}, {43.0088533193921, -81.26109913367962}, {43.00884544233255, -81.2610907312233}, {43.008837565273005, -81.261082328767}, {43.00882968821345, -81.26107392631069}, {43.0088218111539, -81.26106552385438}, {43.00881393409435, -81.26105712139807}, {43.008806057034796, -81.26104871894177}, {43.008798179975244, -81.26104031648545}, {43.0087903029157, -81.26103191402913}, {43.00878242585615, -81.26102351157283}, {43.00877454879659, -81.26101510911653}, {43.008766671737035, -81.26100670666021}, {43.00875879467749, -81.2609983042039}, {43.00875091761794, -81.26098990174759}, {43.00874304055838, -81.26098149929129}, {43.008735163498834, -81.26097309683497}, {43.00872728643928, -81.26096469437866}, {43.00871940937973, -81.26095629192235}, {43.008711532320184, -81.26094788946604}, {43.008703655260625, -81.26093948700974}, {43.00869577820107, -81.26093108455342}, {43.00868790114153, -81.26092268209712}, {43.008680024081976, -81.2609142796408}, {43.008672147022416, -81.26090587718448}, {43.008664269962864, -81.26089747472818}, {43.00865639290332, -81.26088907227188}, {43.00864851584377, -81.26088066981556}, {43.008640638784215, -81.26087226735925}, {43.00863276172466, -81.26086386490294}, {43.00862488466511, -81.26085546244663}, {43.008617007605565, -81.26084705999031}, {43.00860913054601, -81.26083865753401}, {43.00860125348646, -81.26083025507769}, {43.0085933764269, -81.26082185262139}, {43.008585499367356, -81.26081345016507}, {43.008577622307804, -81.26080504770877}, {43.00856974524825, -81.26079664525246}, {43.0085618681887, -81.26078824279614}, {43.00855399112915, -81.26077984033984}, {43.0085461140696, -81.26077143788353}, {43.00853823701005, -81.26076303542722}, {43.0085303599505, -81.26075463297092}, {43.008522482890946, -81.2607462305146}, {43.008514605831394, -81.2607378280583}, {43.00850672877184, -81.26072942560198}, {43.00849885171229, -81.26072102314566}, {43.00849097465274, -81.26071262068936}, {43.008483097593185, -81.26070421823304}, {43.00847522053363, -81.26069581577674}, {43.00846734347408, -81.26068741332043}, {43.008459466414536, -81.26067901086412}, {43.00845158935498, -81.2606706084078}, {43.00844371229543, -81.26066220595149}, {43.00843583523588, -81.26065380349519}, {43.00842795817633, -81.26064540103889}, {43.008420081116775, -81.26063699858257}, {43.00841220405722, -81.26062859612625}, {43.00840432699767, -81.26062019366995}, {43.00839644993812, -81.26061179121365}, {43.008388572878566, -81.26060338875733}, {43.008380695819014, -81.26059498630102}, {43.00837281875947, -81.26058658384471}, {43.00836494169992, -81.2605781813884}, {43.008357064640364, -81.2605697789321}, {43.00834918758081, -81.26056137647578}, {43.00834131052126, -81.26055297401946}, {43.00833343346171, -81.26054457156316}, {43.008325556402156, -81.26053616910684}, {43.0083176793426, -81.26052776665054}, {43.00830980228305, -81.26051936419422}, {43.0083019252235, -81.26051096173791}, {43.00829404816395, -81.2605025592816}, {43.0082861711044, -81.2604941568253}, {43.00827829404484, -81.26048575436899}, {43.0082704169853, -81.26047735191267}, {43.008262539925745, -81.26046894945637}, {43.00825466286619, -81.26046054700006}, {43.00824678580664, -81.26045214454375}, {43.00823890874709, -81.26044374208743}, {43.008231031687544, -81.26043533963113}, {43.008223154627984, -81.26042693717481}, {43.00821527756844, -81.26041853471851}, {43.00820740050888, -81.2604101322622}, {43.008199523449335, -81.26040172980589}, {43.008191646389776, -81.26039332734958}, {43.00818376933023, -81.26038492489326}, {43.008175892270685, -81.26037652243696}, {43.008168015211126, -81.26036811998065}, {43.00816013815158, -81.26035971752434}, {43.00815226109202, -81.26035131506802}, {43.00814438403248, -81.26034291261172}, {43.00813650697292, -81.26033451015542}, {43.00812862991337, -81.26032610769909}, {43.00812075285381, -81.26031770524278}, {43.00811287579427, -81.26030930278648}, {43.008104998734716, -81.26030090033017}, {43.00809712167516, -81.26029249787385}, {43.00808924461561, -81.26028409541755}, {43.00808136755606, -81.26027569296124}, {43.008073490496514, -81.26026729050493}, {43.008065613436955, -81.26025888804861}, {43.00805773637741, -81.26025048559231}, {43.00804985931786, -81.26024208313599}, {43.008041982258305, -81.26023368067969}, {43.00803410519875, -81.26022527822337}, {43.0080262281392, -81.26021687576707}, {43.00801835107965, -81.26020847331075}, {43.0080104740201, -81.26020007085444}, {43.008002596960544, -81.26019166839814}, {43.00799471990099, -81.26018326594183}, {43.00798684284145, -81.2601748634855}, {43.00797896578189, -81.2601664610292}, {43.00797108872234, -81.2601580585729}, {43.00796321166279, -81.2601496561166}, {43.00795533460324, -81.26014125366027}, {43.007947457543686, -81.26013285120396}, {43.007939580484134, -81.26012444874766}, {43.00793170342458, -81.26011604629134}, {43.00792382636503, -81.26010764383503}, {43.00791594930548, -81.26009924137873}, {43.007908072245925, -81.26009083892241}, {43.00790019518638, -81.2600824364661}, {43.00789231812682, -81.26007403400979}, {43.007884441067276, -81.26006563155349}, {43.00787656400772, -81.26005722909717}, {43.00786868694817, -81.26004882664085}, {43.00786080988862, -81.26004042418455}, {43.00785293282907, -81.26003202172825}, {43.007845055769515, -81.26002361927193}, {43.00783717870996, -81.26001521681562}, {43.00782930165041, -81.26000681435931}, {43.00782142459086, -81.259998411903}, {43.00781354753131, -81.25999000944668}, {43.007805670471754, -81.25998160699038}, {43.00779779341221, -81.25997320453408}, {43.00778991635265, -81.25996480207776}, {43.007782039293105, -81.25995639962144}, {43.00777416223355, -81.25994799716514}, {43.007766285174, -81.25993959470883}, {43.00775840811445, -81.25993119225252}, {43.007750531054896, -81.2599227897962}, {43.007742653995344, -81.2599143873399}, {43.00773477693579, -81.25990598488359}, {43.00772689987624, -81.25989758242729}, {43.007719022816694, -81.25988917997097}, {43.00771114575714, -81.25988077751467}, {43.00770326869759, -81.25987237505835}, {43.00769539163804, -81.25986397260203}, {43.007687514578485, -81.25985557014573}, {43.00767963751893, -81.25984716768943}, {43.00767176045938, -81.25983876523311}, {43.007663883399836, -81.2598303627768}, {43.007656006340284, -81.2598219603205}, {43.00764812928073, -81.25981355786418}, {43.00764025222118, -81.25980515540788}, {43.00763237516163, -81.25979675295156}, {43.007624498102075, -81.25978835049526}, {43.00761662104252, -81.25977994803894}, {43.00760874398297, -81.25977154558264}, {43.007600866923426, -81.25976314312632}, {43.007592989863866, -81.25975474067002}, {43.00758511280432, -81.2597463382137}, {43.00757723574476, -81.25973793575739}, {43.00756935868522, -81.25972953330108}, {43.007561481625665, -81.25972113084478}, {43.00755360456611, -81.25971272838846}, {43.00754572750655, -81.25970432593215}, {43.00753785044701, -81.25969592347585}, {43.007529973387456, -81.25968752101953}, {43.007522096327904, -81.25967911856321}, {43.00751421926836, -81.25967071610691}, {43.0075063422088, -81.2596623136506}, {43.00749846514925, -81.25965391119429}, {43.0074905880897, -81.25964550873798}, {43.00748271103015, -81.25963710628167}, {43.00747483397059, -81.25962870382536}, {43.007466956911045, -81.25962030136905}, {43.00745907985149, -81.25961189891274}, {43.00745120279194, -81.25960349645642}, {43.007443325732396, -81.25959509400013}, {43.00743544867284, -81.25958669154382}, {43.007427571613285, -81.2595782890875}, {43.00741969455374, -81.25956988663118}, {43.00741181749419, -81.25956148417488}, {43.00740394043463, -81.25955308171856}, {43.007396063375076, -81.25954467926226}, {43.00738818631553, -81.25953627680595}, {43.00738030925598, -81.25952787434964}, {43.007372432196426, -81.25951947189333}, {43.007364555136874, -81.25951106943701}, {43.00735667807732, -81.25950266698071}, {43.00734880101777, -81.2594942645244}, {43.007340923958225, -81.25948586206809}, {43.007333046898665, -81.25947745961177}, {43.00732516983911, -81.25946905715546}, {43.00731729277957, -81.25946065469917}, {43.007309415720016, -81.25945225224285}, {43.007301538660464, -81.25944384978654}, {43.00729366160091, -81.25943544733022}, {43.00728578454136, -81.25942704487392}, {43.00727790748181, -81.25941864241761}, {43.00727003042226, -81.2594102399613}, {43.0072621533627, -81.25940183750498}, {43.00725427630315, -81.25939343504868}, {43.0072463992436, -81.25938503259236}, {43.00723852218405, -81.25937663013606}, {43.0072306451245, -81.25936822767974}, {43.00722276806494, -81.25935982522344}, {43.0072148910054, -81.25935142276712}, {43.007207013945845, -81.25934302031081}, {43.00719913688629, -81.2593346178545}, {43.00719125982675, -81.2593262153982}, {43.00718338276719, -81.25931781294189}, {43.007175505707636, -81.25930941048557}, {43.00716762864809, -81.25930100802925}, {43.00715975158854, -81.25929260557297}, {43.00715187452899, -81.25928420311665}, {43.007143997469434, -81.25927580066033}, {43.00713612040988, -81.25926739820402}, {43.00712824335033, -81.25925899574771}, {43.00712036629078, -81.25925059329141}, {43.007112489231226, -81.2592421908351}, {43.00710461217167, -81.25923378837878}, {43.00709673511212, -81.25922538592248}, {43.007088858052576, -81.25921698346616}, {43.007080980993024, -81.25920858100986}, {43.007073103933465, -81.25920017855354}, {43.00706522687392, -81.25919177609724}, {43.00705734981437, -81.25918337364092}, {43.007049472754815, -81.2591749711846}, {43.007042, -81.259167}, {43.00703183602454, -81.25916158308742}, {43.00702167204908, -81.25915616617482}, {43.00701150807361, -81.25915074926223}, {43.00700134409815, -81.25914533234963}, {43.00699118012269, -81.25913991543705}, {43.00698101614723, -81.25913449852446}, {43.00697085217177, -81.25912908161186}, {43.0069606881963, -81.25912366469927}, {43.00695052422084, -81.25911824778669}, {43.00694036024537, -81.25911283087407}, {43.00693019626992, -81.2591074139615}, {43.00692003229445, -81.2591019970489}, {43.00690986831899, -81.25909658013632}, {43.006899704343525, -81.25909116322372}, {43.00688954036807, -81.25908574631113}, {43.006879376392604, -81.25908032939853}, {43.00686921241715, -81.25907491248594}, {43.00685904844168, -81.25906949557334}, {43.006848884466216, -81.25906407866076}, {43.006838720490755, -81.25905866174816}, {43.006828556515295, -81.25905324483557}, {43.006818392539834, -81.25904782792298}, {43.00680822856437, -81.25904241101038}, {43.006798064588914, -81.2590369940978}, {43.006787900613446, -81.25903157718521}, {43.00677773663799, -81.25902616027261}, {43.006767572662525, -81.25902074336003}, {43.006757408687065, -81.25901532644743}, {43.0067472447116, -81.25900990953483}, {43.006737080736144, -81.25900449262225}, {43.00672691676068, -81.25899907570964}, {43.006716752785216, -81.25899365879707}, {43.00670658880975, -81.25898824188447}, {43.006696424834296, -81.25898282497188}, {43.00668626085883, -81.25897740805928}, {43.00667609688337, -81.2589719911467}, {43.0066659329079, -81.2589665742341}, {43.00665576893245, -81.25896115732151}, {43.00664560495698, -81.25895574040891}, {43.006635440981526, -81.25895032349634}, {43.00662527700605, -81.25894490658372}, {43.0066151130306, -81.25893948967115}, {43.00660494905513, -81.25893407275855}, {43.00659478507968, -81.25892865584596}, {43.00658462110421, -81.25892323893336}, {43.00657445712875, -81.25891782202078}, {43.00656429315328, -81.25891240510818}, {43.00655412917783, -81.25890698819559}, {43.00654396520236, -81.25890157128299}, {43.0065338012269, -81.2588961543704}, {43.00652363725143, -81.2588907374578}, {43.00651347327598, -81.25888532054523}, {43.00650330930051, -81.25887990363263}, {43.00649314532505, -81.25887448672003}, {43.006482981349585, -81.25886906980745}, {43.00647281737413, -81.25886365289485}, {43.006462653398664, -81.25885823598226}, {43.00645248942321, -81.25885281906967}, {43.006442325447736, -81.25884740215707}, {43.00643216147228, -81.25884198524449}, {43.006421997496815, -81.2588365683319}, {43.006411833521355, -81.2588311514193}, {43.006401669545895, -81.25882573450671}, {43.006391505570434, -81.25882031759411}, {43.00638134159497, -81.25881490068153}, {43.00637117761951, -81.25880948376893}, {43.00636101364404, -81.25880406685633}, {43.006350849668586, -81.25879864994376}, {43.00634068569312, -81.25879323303116}, {43.006330521717665, -81.25878781611857}, {43.0063203577422, -81.25878239920597}, {43.00631019376674, -81.25877698229338}, {43.00630002979128, -81.25877156538078}, {43.006289865815816, -81.2587661484682}, {43.006279701840356, -81.25876073155561}, {43.006269537864895, -81.25875531464303}, {43.00625937388943, -81.25874989773043}, {43.00624920991397, -81.25874448081782}, {43.00623904593851, -81.25873906390524}, {43.00622888196304, -81.25873364699265}, {43.00621871798758, -81.25872823008005}, {43.00620855401212, -81.25872281316747}, {43.00619839003666, -81.25871739625487}, {43.00618822606119, -81.25871197934227}, {43.00617806208573, -81.25870656242968}, {43.00616789811027, -81.2587011455171}, {43.0061577341348, -81.25869572860451}, {43.00614757015934, -81.25869031169191}, {43.00613740618388, -81.25868489477932}, {43.00612724220842, -81.25867947786674}, {43.00611707823296, -81.25867406095414}, {43.0061069142575, -81.25866864404153}, {43.00609675028203, -81.25866322712895}, {43.00608658630658, -81.25865781021636}, {43.00607642233111, -81.25865239330376}, {43.006066258355645, -81.25864697639116}, {43.006056094380185, -81.25864155947858}, {43.006045930404724, -81.25863614256599}, {43.006035766429264, -81.2586307256534}, {43.0060256024538, -81.2586253087408}, {43.006015438478336, -81.25861989182822}, {43.00600527450288, -81.25861447491562}, {43.005995110527415, -81.25860905800303}, {43.005984946551955, -81.25860364109043}, {43.005974782576494, -81.25859822417785}, {43.005964618601034, -81.25859280726526}, {43.00595445462557, -81.25858739035266}, {43.005944290650106, -81.25858197344006}, {43.005934126674646, -81.25857655652747}, {43.005923962699185, -81.25857113961489}, {43.005913798723725, -81.2585657227023}, {43.00590363474826, -81.2585603057897}, {43.0058934707728, -81.25855488887711}, {43.00588330679734, -81.25854947196453}, {43.00587314282187, -81.25854405505193}, {43.00586297884641, -81.25853863813933}, {43.00585281487095, -81.25853322122674}, {43.00584265089549, -81.25852780431416}, {43.00583248692003, -81.25852238740156}, {43.00582232294456, -81.25851697048896}, {43.0058121589691, -81.25851155357637}, {43.00580199499364, -81.25850613666378}, {43.00579183101818, -81.25850071975118}, {43.00578166704271, -81.2584953028386}, {43.00577150306725, -81.25848988592601}, {43.00576133909179, -81.25848446901342}, {43.00575117511633, -81.25847905210082}, {43.00574101114086, -81.25847363518822}, {43.00573084716541, -81.25846821827564}, {43.00572068318995, -81.25846280136304}, {43.00571051921448, -81.25845738445045}, {43.005700355239014, -81.25845196753787}, {43.005690191263554, -81.25844655062527}, {43.0056800272881, -81.25844113371268}, {43.00566986331263, -81.25843571680008}, {43.00565969933717, -81.2584302998875}, {43.00564953536171, -81.25842488297491}, {43.00563937138625, -81.25841946606232}, {43.005629207410784, -81.25841404914972}, {43.00561904343532, -81.25840863223712}, {43.00560887945986, -81.25840321532453}, {43.0055987154844, -81.25839779841195}, {43.005588551508936, -81.25839238149936}, {43.005578387533475, -81.25838696458675}, {43.005568223558015, -81.25838154767416}, {43.005558059582555, -81.25837613076158}, {43.005547895607094, -81.25837071384899}, {43.00553773163162, -81.25836529693638}, {43.005527567656166, -81.25835988002379}, {43.005517403680706, -81.2583544631112}, {43.00550723970524, -81.25834904619862}, {43.00549707572978, -81.25834362928602}, {43.00548691175432, -81.25833821237343}, {43.00547674777886, -81.25833279546084}, {43.0054665838034, -81.25832737854824}, {43.00545641982793, -81.25832196163566}, {43.00544625585247, -81.25831654472307}, {43.005436091877016, -81.25831112781047}, {43.00542592790154, -81.25830571089787}, {43.00541576392608, -81.25830029398529}, {43.00540559995062, -81.2582948770727}, {43.00539543597516, -81.25828946016011}, {43.0053852719997, -81.25828404324751}, {43.00537510802424, -81.25827862633491}, {43.00536494404878, -81.25827320942233}, {43.00535478007331, -81.25826779250974}, {43.00534461609785, -81.25826237559714}, {43.00533445212238, -81.25825695868456}, {43.00532428814692, -81.25825154177195}, {43.00531412417146, -81.25824612485937}, {43.005303960196, -81.25824070794677}, {43.00529379622054, -81.25823529103418}, {43.00528363224508, -81.2582298741216}, {43.00527346826962, -81.258224457209}, {43.005263304294154, -81.25821904029641}, {43.00525314031869, -81.25821362338381}, {43.005242976343226, -81.25820820647122}, {43.005232812367765, -81.25820278955864}, {43.005222648392305, -81.25819737264604}, {43.005212484416845, -81.25819195573345}, {43.005202320441384, -81.25818653882085}, {43.005192156465924, -81.25818112190827}, {43.005181992490456, -81.25817570499567}, {43.005171828515, -81.25817028808308}, {43.005161664539536, -81.2581648711705}, {43.00515150056407, -81.25815945425789}, {43.00514133658861, -81.2581540373453}, {43.00513117261315, -81.2581486204327}, {43.00512100863769, -81.25814320352012}, {43.00511084466223, -81.25813778660753}, {43.005100680686766, -81.25813236969493}, {43.0050905167113, -81.25812695278235}, {43.005080352735845, -81.25812153586975}, {43.00507018876038, -81.25811611895716}, {43.00506002478491, -81.25811070204456}, {43.00504986080945, -81.25810528513198}, {43.00503969683399, -81.25809986821938}, {43.00502953285853, -81.25809445130679}, {43.00501936888307, -81.2580890343942}, {43.00500920490761, -81.2580836174816}, {43.00499904093214, -81.25807820056902}, {43.00498887695669, -81.25807278365643}, {43.00497871298122, -81.25806736674383}, {43.00496854900575, -81.25806194983124}, {43.00495838503029, -81.25805653291864}, {43.00494822105483, -81.25805111600606}, {43.00493805707937, -81.25804569909346}, {43.00492789310391, -81.25804028218087}, {43.00491772912845, -81.25803486526829}, {43.00490756515298, -81.25802944835569}, {43.00489740117752, -81.2580240314431}, {43.00488723720206, -81.2580186145305}, {43.0048770732266, -81.25801319761791}, {43.004866909251135, -81.25800778070533}, {43.004856745275674, -81.25800236379273}, {43.004846581300214, -81.25799694688014}, {43.00483641732475, -81.25799152996754}, {43.00482625334929, -81.25798611305495}, {43.004816089373826, -81.25798069614235}, {43.004805925398365, -81.25797527922977}, {43.004795761422905, -81.25796986231718}, {43.004785597447444, -81.25796444540458}, {43.00477543347198, -81.257959028492}, {43.00476526949652, -81.2579536115794}, {43.004755105521056, -81.25794819466681}, {43.004744941545596, -81.25794277775422}, {43.004734777570135, -81.25793736084162}, {43.00472461359467, -81.25793194392904}, {43.00471444961921, -81.25792652701644}, {43.00470428564375, -81.25792111010385}, {43.00469412166829, -81.25791569319125}, {43.00468395769282, -81.25791027627866}, {43.00467379371736, -81.25790485936608}, {43.0046636297419, -81.25789944245348}, {43.00465346576644, -81.25789402554089}, {43.00464330179098, -81.25788860862829}, {43.00463313781551, -81.2578831917157}, {43.00462297384005, -81.25787777480312}, {43.00461280986459, -81.25787235789052}, {43.00460264588913, -81.25786694097793}, {43.00459248191366, -81.25786152406533}, {43.0045823179382, -81.25785610715275}, {43.00457215396274, -81.25785069024016}, {43.00456198998728, -81.25784527332756}, {43.00455182601181, -81.25783985641496}, {43.00454166203635, -81.25783443950237}, {43.0045314980609, -81.25782902258979}, {43.00452133408543, -81.25782360567719}, {43.00451117010997, -81.2578181887646}, {43.004501006134504, -81.257812771852}, {43.00449084215904, -81.25780735493942}, {43.00448067818358, -81.25780193802683}, {43.00447051420812, -81.25779652111423}, {43.004460350232655, -81.25779110420164}, {43.004450186257195, -81.25778568728904}, {43.00444002228174, -81.25778027037646}, {43.004429858306274, -81.25777485346387}, {43.004419694330814, -81.25776943655129}, {43.00440953035535, -81.25776401963867}, {43.004399366379886, -81.25775860272608}, {43.004389202404425, -81.2577531858135}, {43.004379038428965, -81.25774776890091}, {43.0043688744535, -81.25774235198831}, {43.00435871047804, -81.25773693507571}, {43.00434854650258, -81.25773151816313}, {43.004338382527116, -81.25772610125054}, {43.004328218551656, -81.25772068433795}, {43.004318054576196, -81.25771526742535}, {43.00430789060073, -81.25770985051275}, {43.00429772662527, -81.25770443360017}, {43.00428756264981, -81.25769901668758}, {43.00427739867434, -81.25769359977498}, {43.00426723469888, -81.2576881828624}, {43.00425707072342, -81.2576827659498}, {43.00424690674796, -81.25767734903721}, {43.0042367427725, -81.25767193212462}, {43.00422657879704, -81.25766651521202}, {43.00421641482157, -81.25766109829942}, {43.00420625084611, -81.25765568138684}, {43.00419608687065, -81.25765026447425}, {43.00418592289518, -81.25764484756166}, {43.00417575891972, -81.25763943064906}, {43.00416559494426, -81.25763401373646}, {43.004155430968794, -81.25762859682388}, {43.00414526699334, -81.25762317991129}, {43.00413510301788, -81.2576177629987}, {43.00412493904241, -81.2576123460861}, {43.00411477506695, -81.2576069291735}, {43.00410461109149, -81.25760151226092}, {43.00409444711603, -81.25759609534833}, {43.004084283140564, -81.25759067843573}, {43.004074119165104, -81.25758526152315}, {43.004063955189636, -81.25757984461055}, {43.00405379121418, -81.25757442769796}, {43.00404362723872, -81.25756901078537}, {43.004033463263255, -81.25756359387277}, {43.004023299287795, -81.25755817696019}, {43.004013135312334, -81.25755276004759}, {43.004002971336874, -81.257547343135}, {43.003992807361406, -81.25754192622242}, {43.003982643385946, -81.25753650930982}, {43.00397247941048, -81.25753109239723}, {43.003962315435025, -81.25752567548463}, {43.003952151459565, -81.25752025857204}, {43.0039419874841, -81.25751484165946}, {43.00393182350864, -81.25750942474686}, {43.00392165953318, -81.25750400783426}, {43.003911495557716, -81.25749859092167}, {43.00390133158225, -81.25749317400908}, {43.00389116760679, -81.25748775709648}, {43.00388100363133, -81.2574823401839}, {43.00387083965586, -81.2574769232713}, {43.00386067568041, -81.25747150635871}, {43.00385051170495, -81.25746608944613}, {43.00384034772948, -81.25746067253353}, {43.00383018375402, -81.25745525562094}, {43.00382001977856, -81.25744983870834}, {43.00380985580309, -81.25744442179575}, {43.00379969182763, -81.25743900488317}, {43.00378952785217, -81.25743358797057}, {43.0037793638767, -81.25742817105798}, {43.00376919990125, -81.25742275414538}, {43.00375903592579, -81.2574173372328}, {43.00374887195032, -81.2574119203202}, {43.00373870797486, -81.25740650340761}, {43.0037285439994, -81.25740108649502}, {43.003719, -81.257396}, {43.00372210193535, -81.25738490823115}, {43.00372520387071, -81.25737381646229}, {43.003728305806064, -81.25736272469344}, {43.00373140774142, -81.2573516329246}, {43.00373450967678, -81.25734054115573}, {43.00373761161214, -81.25732944938689}, {43.003740713547494, -81.25731835761805}, {43.00374381548285, -81.25730726584918}, {43.003746917418205, -81.25729617408034}, {43.00375001935356, -81.25728508231147}, {43.003753121288916, -81.25727399054263}, {43.00375622322428, -81.25726289877379}, {43.003759325159635, -81.25725180700492}, {43.003762427095, -81.25724071523608}, {43.003765529030346, -81.25722962346723}, {43.00376863096571, -81.25721853169837}, {43.003771732901065, -81.25720743992952}, {43.00377483483642, -81.25719634816068}, {43.003777936771776, -81.25718525639181}, {43.00378103870713, -81.25717416462297}, {43.003784140642495, -81.2571630728541}, {43.00378724257785, -81.25715198108526}, {43.003790344513206, -81.2571408893164}, {43.00379344644856, -81.25712979754755}, {43.00379654838392, -81.2571187057787}, {43.00379965031927, -81.25710761400985}, {43.00380275225463, -81.25709652224099}, {43.003805854189984, -81.25708543047215}, {43.00380895612534, -81.2570743387033}, {43.0038120580607, -81.25706324693444}, {43.00381515999606, -81.2570521551656}, {43.00381826193142, -81.25704106339674}, {43.00382136386677, -81.25702997162789}, {43.00382446580213, -81.25701887985905}, {43.00382756773748, -81.25700778809019}, {43.003830669672844, -81.25699669632134}, {43.0038337716082, -81.25698560455248}, {43.00383687354356, -81.25697451278363}, {43.00383997547892, -81.25696342101477}, {43.003843077414274, -81.25695232924593}, {43.00384617934963, -81.25694123747706}, {43.003849281284985, -81.25693014570822}, {43.00385238322034, -81.25691905393937}, {43.0038554851557, -81.25690796217052}, {43.00385858709105, -81.25689687040166}, {43.00386168902641, -81.25688577863282}, {43.00386479096177, -81.25687468686395}, {43.00386789289713, -81.25686359509511}, {43.00387099483248, -81.25685250332626}, {43.00387409676784, -81.2568414115574}, {43.003877198703194, -81.25683031978856}, {43.003880300638556, -81.2568192280197}, {43.003883402573905, -81.25680813625085}, {43.00388650450927, -81.25679704448201}, {43.00388960644462, -81.25678595271314}, {43.003892708379986, -81.2567748609443}, {43.003895810315335, -81.25676376917545}, {43.0038989122507, -81.2567526774066}, {43.00390201418605, -81.25674158563774}, {43.00390511612141, -81.2567304938689}, {43.003908218056765, -81.25671940210003}, {43.00391131999213, -81.25670831033119}, {43.00391442192748, -81.25669721856232}, {43.00391752386284, -81.25668612679348}, {43.003920625798195, -81.25667503502463}, {43.00392372773355, -81.25666394325577}, {43.003926829668906, -81.25665285148692}, {43.00392993160426, -81.25664175971808}, {43.00393303353962, -81.25663066794921}, {43.00393613547497, -81.25661957618037}, {43.003939237410336, -81.25660848441152}, {43.0039423393457, -81.25659739264266}, {43.00394544128105, -81.25658630087382}, {43.00394854321641, -81.25657520910497}, {43.00395164515176, -81.25656411733611}, {43.00395474708712, -81.25655302556727}, {43.00395784902247, -81.25654193379842}, {43.00396095095783, -81.25653084202956}, {43.003964052893195, -81.25651975026071}, {43.00396715482855, -81.25650865849187}, {43.00397025676391, -81.256497566723}, {43.00397335869926, -81.25648647495416}, {43.00397646063462, -81.25647538318529}, {43.003979562569974, -81.25646429141645}, {43.00398266450533, -81.2564531996476}, {43.003985766440685, -81.25644210787874}, {43.00398886837604, -81.25643101610989}, {43.003991970311404, -81.25641992434103}, {43.00399507224676, -81.25640883257218}, {43.003998174182115, -81.25639774080334}, {43.00400127611747, -81.25638664903448}, {43.004004378052834, -81.25637555726563}, {43.00400747998818, -81.25636446549679}, {43.004010581923545, -81.25635337372793}, {43.0040136838589, -81.25634228195906}, {43.00401678579426, -81.25633119019022}, {43.00401988772961, -81.25632009842137}, {43.004022989664975, -81.25630900665251}, {43.00402609160033, -81.25629791488367}, {43.004029193535686, -81.25628682311482}, {43.00403229547104, -81.25627573134597}, {43.0040353974064, -81.25626463957713}, {43.00403849934176, -81.25625354780826}, {43.00404160127711, -81.25624245603942}, {43.00404470321247, -81.25623136427055}, {43.00404780514783, -81.25622027250171}, {43.00405090708318, -81.25620918073285}, {43.00405400901854, -81.256198088964}, {43.004057110953894, -81.25618699719516}, {43.00406021288925, -81.2561759054263}, {43.004063314824606, -81.25616481365745}, {43.00406641675997, -81.2561537218886}, {43.004069518695324, -81.25614263011974}, {43.00407262063068, -81.25613153835089}, {43.00407572256604, -81.25612044658203}, {43.00407882450139, -81.25610935481319}, {43.004081926436754, -81.25609826304434}, {43.0040850283721, -81.25608717127548}, {43.004088130307466, -81.25607607950663}, {43.00409123224283, -81.25606498773779}, {43.00409433417818, -81.25605389596893}, {43.00409743611353, -81.25604280420006}, {43.00410053804889, -81.25603171243122}, {43.00410363998425, -81.25602062066238}, {43.00410674191961, -81.25600952889351}, {43.00410984385496, -81.25599843712466}, {43.004112945790325, -81.25598734535582}, {43.00411604772568, -81.25597625358697}, {43.00411914966104, -81.25596516181811}, {43.004122251596385, -81.25595407004926}, {43.00412535353175, -81.25594297828042}, {43.00412845546711, -81.25593188651156}, {43.00413155740246, -81.2559207947427}, {43.004134659337815, -81.25590970297385}, {43.00413776127318, -81.255898611205}, {43.004140863208534, -81.25588751943616}, {43.00414396514389, -81.2558764276673}, {43.004147067079245, -81.25586533589845}, {43.0041501690146, -81.2558542441296}, {43.00415327094996, -81.25584315236074}, {43.00415637288532, -81.25583206059189}, {43.004159474820675, -81.25582096882303}, {43.00416257675603, -81.25580987705419}, {43.00416567869139, -81.25579878528534}, {43.00416878062674, -81.25578769351648}, {43.0041718825621, -81.25577660174763}, {43.00417498449746, -81.25576550997877}, {43.004178086432816, -81.25575441820993}, {43.00418118836817, -81.25574332644108}, {43.00418429030353, -81.25573223467222}, {43.00418739223888, -81.25572114290337}, {43.004190494174246, -81.25571005113453}, {43.0041935961096, -81.25569895936567}, {43.00419669804495, -81.2556878675968}, {43.00419979998031, -81.25567677582796}, {43.00420290191567, -81.25566568405912}, {43.004206003851024, -81.25565459229026}, {43.00420910578638, -81.2556435005214}, {43.00421220772174, -81.25563240875256}, {43.0042153096571, -81.2556213169837}, {43.004218411592454, -81.25561022521485}, {43.00422151352781, -81.255599133446}, {43.004224615463166, -81.25558804167716}, {43.00422771739853, -81.2555769499083}, {43.004230819333884, -81.25556585813945}, {43.00423392126923, -81.2555547663706}, {43.004237023204595, -81.25554367460174}, {43.00424012513996, -81.2555325828329}, {43.00424322707531, -81.25552149106404}, {43.00424632901066, -81.25551039929519}, {43.00424943094602, -81.25549930752634}, {43.00425253288138, -81.25548821575748}, {43.00425563481674, -81.25547712398863}, {43.00425873675209, -81.25546603221977}, {43.004261838687455, -81.25545494045093}, {43.004264940622804, -81.25544384868208}, {43.00426804255817, -81.25543275691322}, {43.004271144493515, -81.25542166514437}, {43.00427424642888, -81.25541057337551}, {43.00427734836424, -81.25539948160667}, {43.00428045029959, -81.25538838983782}, {43.00428355223495, -81.25537729806896}, {43.0042866541703, -81.25536620630011}, {43.00428975610566, -81.25535511453127}, {43.004292858041026, -81.25534402276242}, {43.004295959976375, -81.25533293099355}, {43.00429906191174, -81.2553218392247}, {43.00430216384709, -81.25531074745587}, {43.00430526578245, -81.255299655687}, {43.0043083677178, -81.25528856391814}, {43.00431146965316, -81.2552774721493}, {43.00431457158852, -81.25526638038045}, {43.00431767352387, -81.2552552886116}, {43.004320775459234, -81.25524419684274}, {43.00432387739459, -81.2552331050739}, {43.004326979329946, -81.25522201330504}, {43.0043300812653, -81.25521092153619}, {43.00433318320066, -81.25519982976734}, {43.00433628513602, -81.25518873799848}, {43.004339387071376, -81.25517764622964}, {43.00434248900673, -81.25516655446077}, {43.00434559094209, -81.25515546269193}, {43.00434869287744, -81.25514437092308}, {43.004351794812806, -81.25513327915422}, {43.004354896748154, -81.25512218738538}, {43.00435799868352, -81.25511109561651}, {43.00436110061887, -81.25510000384767}, {43.00436420255423, -81.25508891207882}, {43.004367304489584, -81.25507782030996}, {43.00437040642494, -81.25506672854111}, {43.0043735083603, -81.25505563677225}, {43.00437661029566, -81.25504454500341}, {43.004379712231014, -81.25503345323456}, {43.00438281416636, -81.2550223614657}, {43.004385916101725, -81.25501126969685}, {43.00438901803709, -81.25500017792801}, {43.00439211997244, -81.25498908615916}, {43.00439522190779, -81.25497799439029}, {43.004398323843155, -81.25496690262145}, {43.00440142577851, -81.2549558108526}, {43.00440452771387, -81.25494471908374}, {43.00440762964922, -81.25493362731488}, {43.004410731584585, -81.25492253554604}, {43.00441383351993, -81.25491144377719}, {43.004416935455296, -81.25490035200833}, {43.00442003739065, -81.25488926023948}, {43.00442313932601, -81.25487816847064}, {43.00442624126136, -81.25486707670177}, {43.00442934319672, -81.25485598493293}, {43.00443244513208, -81.25484489316408}, {43.00443554706744, -81.25483380139522}, {43.00443864900279, -81.25482270962638}, {43.004441750938156, -81.25481161785753}, {43.004444852873505, -81.25480052608867}, {43.00444795480886, -81.25478943431983}, {43.004451056744216, -81.25477834255096}, {43.00445415867958, -81.25476725078212}, {43.004457260614934, -81.25475615901325}, {43.00446036255029, -81.25474506724441}, {43.00446346448565, -81.25473397547556}, {43.004466566421, -81.2547228837067}, {43.004469668356364, -81.25471179193786}, {43.00447277029172, -81.254700700169}, {43.004475872227076, -81.25468960840016}, {43.00447897416244, -81.2546785166313}, {43.00448207609779, -81.25466742486245}, {43.00448517803315, -81.2546563330936}, {43.0044882799685, -81.25464524132475}, {43.00449138190386, -81.2546341495559}, {43.00449448383922, -81.25462305778704}, {43.00449758577457, -81.25461196601819}, {43.004500687709935, -81.25460087424933}, {43.004503789645284, -81.25458978248048}, {43.00450689158065, -81.25457869071164}, {43.004509993516, -81.25456759894278}, {43.00451309545136, -81.25455650717393}, {43.004516197386714, -81.25454541540509}, {43.00451929932207, -81.25453432363622}, {43.00452240125743, -81.25452323186738}, {43.00452550319278, -81.25451214009853}, {43.004528605128144, -81.25450104832967}, {43.0045317070635, -81.25448995656082}, {43.004534808998855, -81.25447886479196}, {43.00453791093422, -81.25446777302312}, {43.004541012869566, -81.25445668125425}, {43.00454411480493, -81.25444558948541}, {43.004547216740285, -81.25443449771656}, {43.00455031867564, -81.2544234059477}, {43.004553420610996, -81.25441231417886}, {43.00455652254635, -81.25440122241001}, {43.004559624481715, -81.25439013064116}, {43.00456272641706, -81.2543790388723}, {43.004565828352426, -81.25436794710345}, {43.00456893028778, -81.25435685533459}, {43.00457203222314, -81.25434576356574}, {43.0045751341585, -81.2543346717969}, {43.00457823609385, -81.25432358002804}, {43.00458133802921, -81.25431248825919}, {43.00458443996456, -81.25430139649035}, {43.00458754189992, -81.2542903047215}, {43.00459064383528, -81.25427921295264}, {43.004593745770634, -81.25426812118378}, {43.004596847706, -81.25425702941493}, {43.00459994964135, -81.25424593764609}, {43.00460305157671, -81.25423484587722}, {43.004606153512064, -81.25422375410838}, {43.00460925544742, -81.25421266233953}, {43.00461235738278, -81.25420157057067}, {43.00461545931814, -81.25419047880182}, {43.004618561253494, -81.25417938703296}, {43.00462166318885, -81.25416829526412}, {43.004624765124206, -81.25415720349527}, {43.00462786705956, -81.25414611172641}, {43.00463096899492, -81.25413501995756}, {43.00463407093028, -81.2541239281887}, {43.004637172865635, -81.25411283641986}, {43.00464027480099, -81.25410174465101}, {43.00464337673635, -81.25409065288216}, {43.0046464786717, -81.2540795611133}, {43.004649580607065, -81.25406846934445}, {43.004652682542414, -81.2540573775756}, {43.00465578447778, -81.25404628580675}, {43.00465888641313, -81.2540351940379}, {43.00466198834849, -81.25402410226904}, {43.004665090283844, -81.25401301050019}, {43.0046681922192, -81.25400191873135}, {43.00467129415456, -81.2539908269625}, {43.00467439608992, -81.25397973519364}, {43.00467749802527, -81.25396864342478}, {43.00468059996063, -81.25395755165593}, {43.004683701895985, -81.25394645988708}, {43.00468680383134, -81.25393536811822}, {43.004689905766696, -81.25392427634938}, {43.00469300770206, -81.25391318458053}, {43.004696109637415, -81.25390209281167}, {43.00469921157277, -81.25389100104283}, {43.004702313508126, -81.25387990927396}, {43.00470541544348, -81.25386881750512}, {43.004708517378845, -81.25385772573627}, {43.0047116193142, -81.25384663396741}, {43.004714721249556, -81.25383554219857}, {43.00471782318491, -81.2538244504297}, {43.00472092512027, -81.25381335866086}, {43.00472402705562, -81.25380226689201}, {43.00472712899098, -81.25379117512315}, {43.00473023092634, -81.2537800833543}, {43.0047333328617, -81.25376899158545}, {43.00473643479705, -81.2537578998166}, {43.00473953673241, -81.25374680804775}, {43.004742638667764, -81.2537357162789}, {43.00474574060313, -81.25372462451004}, {43.00474884253848, -81.25371353274119}, {43.00475194447384, -81.25370244097235}, {43.004755046409194, -81.25369134920348}, {43.00475814834455, -81.25368025743464}, {43.004761250279905, -81.25366916566578}, {43.00476435221527, -81.25365807389693}, {43.004767454150624, -81.25364698212809}, {43.00477055608599, -81.25363589035923}, {43.004773658021335, -81.25362479859038}, {43.00477675995669, -81.25361370682153}, {43.00477986189205, -81.25360261505267}, {43.0047829638274, -81.25359152328383}, {43.004786065762765, -81.25358043151498}, {43.00478916769812, -81.25356933974612}, {43.004792269633484, -81.25355824797727}, {43.00479537156883, -81.25354715620841}, {43.004798473504195, -81.25353606443956}, {43.004801575439544, -81.2535249726707}, {43.004804677374906, -81.25351388090186}, {43.00480777931026, -81.25350278913301}, {43.00481088124562, -81.25349169736415}, {43.00481398318098, -81.2534806055953}, {43.00481708511633, -81.25346951382645}, {43.00482018705169, -81.2534584220576}, {43.00482328898704, -81.25344733028875}, {43.0048263909224, -81.2534362385199}, {43.00482949285776, -81.25342514675106}, {43.00483259479312, -81.2534140549822}, {43.00483569672848, -81.25340296321335}, {43.00483879866383, -81.25339187144449}, {43.00484190059919, -81.25338077967564}, {43.00484500253454, -81.2533696879068}, {43.0048481044699, -81.25335859613793}, {43.004851206405256, -81.25334750436907}, {43.00485430834062, -81.25333641260022}, {43.00485741027597, -81.25332532083138}, {43.00486051221133, -81.25331422906252}, {43.004863614146686, -81.25330313729367}, {43.00486671608205, -81.25329204552482}, {43.0048698180174, -81.25328095375596}, {43.00487291995276, -81.25326986198712}, {43.004876021888116, -81.25325877021827}, {43.004879123823464, -81.25324767844941}, {43.00488222575883, -81.25323658668056}, {43.00488532769418, -81.25322549491172}, {43.004888429629545, -81.25321440314286}, {43.004891531564894, -81.25320331137401}, {43.00489463350026, -81.25319221960515}, {43.00489773543561, -81.25318112783631}, {43.00490083737097, -81.25317003606746}, {43.004903939306324, -81.2531589442986}, {43.00490704124169, -81.25314785252975}, {43.00491014317704, -81.2531367607609}, {43.00491324511239, -81.25312566899206}, {43.004916347047754, -81.2531145772232}, {43.00491944898311, -81.25310348545435}, {43.004922550918465, -81.25309239368548}, {43.00492565285382, -81.25308130191664}, {43.004928754789184, -81.25307021014778}, {43.00493185672454, -81.25305911837893}, {43.004934958659895, -81.25304802661007}, {43.00493806059525, -81.25303693484122}, {43.00494116253061, -81.25302584307238}, {43.00494426446596, -81.25301475130352}, {43.00494736640132, -81.25300365953467}, {43.00495046833668, -81.25299256776583}, {43.004953570272036, -81.25298147599698}, {43.00495667220739, -81.25297038422812}, {43.00495977414275, -81.25295929245927}, {43.00496287607811, -81.25294820069041}, {43.00496597801346, -81.25293710892157}, {43.00496907994882, -81.25292601715272}, {43.00497218188418, -81.25291492538386}, {43.00497528381953, -81.25290383361501}, {43.00497838575489, -81.25289274184615}, {43.004981487690245, -81.25288165007731}, {43.00498458962561, -81.25287055830846}, {43.004987691560956, -81.2528594665396}, {43.00499079349632, -81.25284837477075}, {43.004993895431674, -81.25283728300191}, {43.00499699736703, -81.25282619123304}, {43.005000099302386, -81.25281509946419}, {43.00500320123775, -81.25280400769533}, {43.005006303173104, -81.25279291592649}, {43.00500940510845, -81.25278182415764}, {43.005012507043816, -81.25277073238878}, {43.00501560897917, -81.25275964061993}, {43.00501871091453, -81.25274854885109}, {43.00502181284988, -81.25273745708223}, {43.005024914785245, -81.25272636531338}, {43.0050280167206, -81.25271527354452}, {43.00503111865596, -81.25270418177567}, {43.00503422059131, -81.25269309000683}, {43.005037322526675, -81.25268199823797}, {43.005040424462024, -81.25267090646912}, {43.00504352639738, -81.25265981470027}, {43.00504662833274, -81.25264872293143}, {43.0050497302681, -81.25263763116257}, {43.005052832203454, -81.25262653939372}, {43.00505593413881, -81.25261544762486}, {43.00505903607417, -81.25260435585601}, {43.00506213800952, -81.25259326408717}, {43.005065239944884, -81.25258217231831}, {43.00506834188024, -81.25257108054946}, {43.0050714438156, -81.2525599887806}, {43.00507454575095, -81.25254889701175}, {43.005077647686306, -81.2525378052429}, {43.00508074962167, -81.25252671347404}, {43.00508385155702, -81.25251562170519}, {43.00508695349238, -81.25250452993635}, {43.005090055427736, -81.25249343816749}, {43.0050931573631, -81.25248234639864}, {43.00509625929845, -81.25247125462978}, {43.00509936123381, -81.25246016286093}, {43.005102463169166, -81.25244907109209}, {43.005105, -81.25244}, {43.005094860710294, -81.25243453702063}, {43.005084721420594, -81.25242907404127}, {43.00507458213089, -81.2524236110619}, {43.00506444284119, -81.25241814808254}, {43.00505430355149, -81.25241268510318}, {43.00504416426179, -81.25240722212381}, {43.00503402497208, -81.25240175914445}, {43.005023885682384, -81.25239629616507}, {43.00501374639268, -81.25239083318571}, {43.00500360710298, -81.25238537020635}, {43.00499346781328, -81.25237990722698}, {43.00498332852357, -81.25237444424761}, {43.004973189233866, -81.25236898126825}, {43.004963049944166, -81.25236351828889}, {43.00495291065447, -81.25235805530951}, {43.00494277136477, -81.25235259233015}, {43.00493263207506, -81.25234712935078}, {43.004922492785354, -81.25234166637142}, {43.004912353495655, -81.25233620339205}, {43.004902214205956, -81.25233074041269}, {43.004892074916256, -81.25232527743333}, {43.00488193562655, -81.25231981445395}, {43.004873, -81.252315}};
    private int demoRouteIndex = 0;
    private Timer demoRouteTimer;

    private Marker[] demoRouteMarkers;

    public static FaceContourDetectorProcessor faceProcessor;
    public static CameraSource cameraSource = null;
    private static final String FACE_CONTOUR = "Face Contour";
    private CameraSourcePreview preview;
    private GraphicOverlay graphicOverlay;

    private MapView mapView;

    TextToSpeech t1;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_map);

//        mapView = findViewById(R.id.map);
//        FragmentManager fm = getFragmentManager();
//        fm.beginTransaction()
//                .setCustomAnimations(android.R.animator.fade_in, android.R.animator.fade_out)
//                .show(somefrag)
//                .commit();
//        mapView.setVisibility(View.INVISIBLE);

        //if you want to update the items at a later time it is recommended to keep it in a variable
        ToggleDrawerItem reminderToggle = new ToggleDrawerItem().withIdentifier(0).withDescription("Reminder").withChecked(false);
        ToggleDrawerItem feedbackToggle = new ToggleDrawerItem().withIdentifier(0).withDescription("Feedback").withChecked(true);
        PrimaryDrawerItem frequency = new PrimaryDrawerItem().withIdentifier(1).withName("Frequency");
        PrimaryDrawerItem feedback = new PrimaryDrawerItem().withIdentifier(2).withName("Feedback after");
        PrimaryDrawerItem camera = new PrimaryDrawerItem().withIdentifier(3).withName("Camera");
        PrimaryDrawerItem startDemoRoute = new PrimaryDrawerItem().withIdentifier(4).withName("Start demo route");


        //create the drawer and remember the `Drawer` result object
        Drawer result = new DrawerBuilder()
                .withActivity(this)
                .withActionBarDrawerToggle(true)
                .withActionBarDrawerToggleAnimated(true)
                .withCloseOnClick(true)
                .withSelectedItem(-1)
                .addDrawerItems(
                        reminderToggle,
                        feedbackToggle,
                        frequency,
                        feedback,
                        camera,
                        startDemoRoute
                )

                .withOnDrawerItemClickListener(new Drawer.OnDrawerItemClickListener() {
                    @Override
                    public boolean onItemClick(View view, int position, IDrawerItem drawerItem) {
                        if (drawerItem.getIdentifier() == 3) {
                            if (preview.getVisibility() == View.INVISIBLE) {
                                preview.setVisibility(View.VISIBLE);
                                graphicOverlay.setVisibility(View.VISIBLE);
                            } else {
                                preview.setVisibility(View.INVISIBLE);
                                graphicOverlay.setVisibility(View.INVISIBLE);
                            }
//                            Intent intent = new Intent(getBaseContext(), LivePreviewActivity.class);
//                            view.getContext().startActivity(intent);
                        }
                        if (drawerItem.getIdentifier() == 4) {
                            setDestination("Ryerson Public School");
                            runDemoRoute();
                        }
                        return true;
                    }

                })
//                .withOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
//                    @Override
//                    public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
//                        Log.i("material-drawer", "toggleChecked: " + isChecked);
//                    }
//                })
                .build();



        // Obtain the SupportMapFragment and get notified when the map is ready to be used.
        SupportMapFragment mapFragment = (SupportMapFragment) getSupportFragmentManager()
                .findFragmentById(R.id.map);
        mapFragment.getMapAsync(this);

        // Instantiate the RequestQueue.
        queue = Volley.newRequestQueue(this);

        fusedLocationClient = LocationServices.getFusedLocationProviderClient(this);

        demoRouteTimer = new Timer();

        t1 = new TextToSpeech(getApplicationContext(), new TextToSpeech.OnInitListener() {
            @Override
            public void onInit(int status) {
                if(status != TextToSpeech.ERROR) {
                    t1.setLanguage(Locale.US);
                }
            }
        });
        faceProcessor = new FaceContourDetectorProcessor(t1);

        preview = findViewById(R.id.firePreview);
        if (preview == null) {
            Log.d(TAG, "Preview is null");
        }
        preview.setVisibility(View.INVISIBLE);
        graphicOverlay = findViewById(R.id.fireFaceOverlay);

        Log.d(TAG, "this is it overlay: " + graphicOverlay);
        if (graphicOverlay == null) {
            Log.d(TAG, "graphicOverlay is null");
        }
        graphicOverlay.setVisibility(View.INVISIBLE);


        createCameraSource("Face Contour");
        cameraSource.setFacing(CameraSource.CAMERA_FACING_FRONT);
        startCameraSource();
    }

    private void startCameraSource() {
        if (cameraSource != null) {
            try {
                if (preview == null) {
                    Log.d(TAG, "resume: Preview is null");
                }
                if (graphicOverlay == null) {
                    Log.d(TAG, "resume: graphOverlay is null");
                }
                preview.start(cameraSource, graphicOverlay);
            } catch (IOException e) {
                Log.e(TAG, "Unable to start camera source.", e);
                cameraSource.release();
                cameraSource = null;
            }
        }
    }

    private void createCameraSource(String model) {
        // If there's no existing cameraSource, create one.
        if (cameraSource == null) {
            cameraSource = new CameraSource(this, graphicOverlay);
        }

        try {
            switch (model) {
                case FACE_CONTOUR:
                    Log.i(TAG, "Using Face Contour Detector Processor");
                    cameraSource.setMachineLearningFrameProcessor(faceProcessor);
                    break;
                default:
                    Log.e(TAG, "Unknown model: " + model);
            }
        } catch (Exception e) {
            Log.e(TAG, "Can not create image processor: " + model, e);
            Toast.makeText(
                    getApplicationContext(),
                    "Can not create image processor: " + e.getMessage(),
                    Toast.LENGTH_LONG)
                    .show();
        }
    }

    @Override
    public void onMapReady(GoogleMap googleMap) {
        mMap = googleMap;

        // TODO: Before enabling the My Location layer, you must request
        // location permission from the user. This sample does not include
        // a request for location permission.
        mMap.setMyLocationEnabled(true);
        mMap.setOnMyLocationButtonClickListener(this);


        String url = "https://maps.london.ca/arcgisa/rest/services/OpenData/OpenData_Transportation/MapServer/16/query?where=1%3D1&outFields=*&outSR=4326&f=json";
        StringRequest stringRequest = new StringRequest(Request.Method.GET, url,
                new Response.Listener<String>() {
                    @Override
                    public void onResponse(String response) {
                        try {
                            JSONObject json = new JSONObject(response);
                            JSONArray features = json.getJSONArray("features");
                            for (int i = 0; i < features.length(); i++) {
                                JSONObject f = features.getJSONObject(i);
                                String type = f.getJSONObject("attributes").getString("IntersectionType");
                                JSONObject geometry = f.getJSONObject("geometry");

                                LatLng pos = new LatLng(geometry.getDouble("y"), geometry.getDouble("x"));
                                Marker m = mMap.addMarker(new MarkerOptions()
                                        .position(pos).title(type));
                                intersections.add(m);
                            }
                        } catch (JSONException e) {
                            e.printStackTrace();
                        }
                    }
                }, new Response.ErrorListener() {
                    @Override
                    public void onErrorResponse(VolleyError e) {
                        e.printStackTrace();
                    }
                });
        stringRequest.setRetryPolicy(new DefaultRetryPolicy(5000,
                DefaultRetryPolicy.DEFAULT_MAX_RETRIES,
                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT));
        queue.add(stringRequest);
    }

    @Override
    public void onResume() {
        super.onResume();
        fusedLocationClient.getLastLocation()
                .addOnSuccessListener(this, new OnSuccessListener<Location>() {
                    @Override
                    public void onSuccess(Location location) {
                        if (location != null) {
                            mLastLocation = mCurrentLocation;
                            mCurrentLocation = new LatLng(location.getLatitude(), location.getLongitude());
                            mMap.moveCamera(CameraUpdateFactory.newLatLngZoom(
                                    mCurrentLocation, 15));

                            onLocationUpdated();
                        }
                    }
                })
                .addOnFailureListener(this, new OnFailureListener() {
                    @Override
                    public void onFailure(@NonNull Exception e) {
                        Log.e(TAG, "Failed to get location: ", e);
                    }
                });
    }

    @Override
    public boolean onMyLocationButtonClick() {
        // Return false so that we don't consume the event and the default behavior still occurs
        // (the camera animates to the user's current position).
        return false;
    }

    public void onLocationUpdated() {
        double minDistance = 50; // Threshold of 50
        Marker nearest = null;
        for (Marker intersection : intersections) {
            double dist = distance(mCurrentLocation, intersection.getPosition());
            if (dist < minDistance) {
                minDistance = dist;
                nearest = intersection;
            }
        }

        if (nearest != null) {
            if (approaching != nearest) {
                approaching = nearest;
                reachedIntersection = false;

                if (true) { //TODO: This will be toggleReminders
                    if (approaching.getTitle().equals("Signalized Intersection")) {
                        Toast.makeText(this, R.string.reminder_intersection_signaled_free, Toast.LENGTH_SHORT).show();
                        t1.speak(getString(R.string.reminder_intersection_signaled_free), TextToSpeech.QUEUE_ADD, null);
                    } else {
                        Toast.makeText(this, R.string.reminder_intersection_unsignaled_free, Toast.LENGTH_SHORT).show();
                        t1.speak(getString(R.string.reminder_intersection_unsignaled_free), TextToSpeech.QUEUE_ADD, null);
                    }
                    enterIntersectionTime = (double) System.currentTimeMillis()/1000;
                }

            }

            if (minDistance < 10) {
                reachedIntersection = true;
            }
            else if (reachedIntersection && minDistance > 10 ) {
                if (true) { //TODO: This will be toggleFeedback
                    double leftDiff = (double) System.currentTimeMillis()/1000 - enterIntersectionTime;
                    double rightDiff = (double) System.currentTimeMillis()/1000 - enterIntersectionTime;
                    Toast.makeText(
                            getApplicationContext(),
                            "ld rd ll lr" + leftDiff + " " + rightDiff + " " + faceProcessor.getLastLeft() + " " + faceProcessor.getLastRight() + ";;;;",
                            Toast.LENGTH_LONG)
                            .show();
                    Log.d(TAG, "ld rd ll lr" + leftDiff + " " + rightDiff + " " + faceProcessor.getLastLeft() + " " + faceProcessor.getLastRight() + ";;;;");
                    if (leftDiff < faceProcessor.getLastLeft() && rightDiff < faceProcessor.getLastRight()) {
                        t1.speak(getString(R.string.feedback_bad_both_scan), TextToSpeech.QUEUE_ADD, null);
                    } else if (leftDiff < faceProcessor.getLastLeft()) {
                        t1.speak(getString(R.string.feedback_bad_left_scan), TextToSpeech.QUEUE_ADD, null);
                    } else if (rightDiff < faceProcessor.getLastRight()) {
                        t1.speak(getString(R.string.feedback_bad_right_scan), TextToSpeech.QUEUE_ADD, null);;
                    } else {
                        t1.speak(getString(R.string.feedback_good_intersection), TextToSpeech.QUEUE_ADD, null);
                    }
                    reachedIntersection = false;
                }
            }
        }
    }

    public double distance(LatLng a, LatLng b) {
        double xDist = (a.latitude - b.latitude) * 111111.1;
        double yDist = (a.longitude - b.longitude) * 111111.1 * Math.cos((a.latitude + b.latitude) / 2.0);

        return Math.sqrt(Math.pow(xDist, 2) + Math.pow(yDist, 2));
    }

    public void setDestination(String destination) {
        String url = String.format(Locale.US,
                "https://maps.googleapis.com/maps/api/directions/json?origin=%.6f,%.6f&destination=%s&key=%s&mode=driving&avoid=tolls|highways|ferries&region=ca",
                mCurrentLocation.latitude,
                mCurrentLocation.longitude,
                URLEncoder.encode(destination),
                getString(R.string.google_maps_key));
        StringRequest stringRequest = new StringRequest(Request.Method.GET, url,
                new Response.Listener<String>() {
                    @Override
                    public void onResponse(String response) {
                        try {
                            Log.i(TAG, "ROUTE RESPONSE:");
                            Log.i(TAG, response);

                            JSONObject route = new JSONObject(response)
                                    .getJSONArray("routes")
                                    .getJSONObject(0);

                            JSONObject neCorner = route.getJSONObject("bounds").getJSONObject("northeast");
                            JSONObject swCorner = route.getJSONObject("bounds").getJSONObject("southwest");

                            LatLngBounds bounds = new LatLngBounds(
                                    new LatLng(swCorner.getDouble("lat"), swCorner.getDouble("lng")),
                                    new LatLng(neCorner.getDouble("lat"), neCorner.getDouble("lng")));

                                    mMap.moveCamera(CameraUpdateFactory.newLatLngBounds(bounds, 0));

                            JSONArray steps = route
                                    .getJSONArray("legs")
                                    .getJSONObject(0)
                                    .getJSONArray("steps");

                            for (int i = 0; i < steps.length(); i++) {
                                JSONObject step = steps.getJSONObject(i);
                                String maneuver = step.optString("maneuver", "no-maneuver");

                                JSONObject location = step.getJSONObject("start_location");
                                LatLng pos = new LatLng(location.getDouble("lat"), location.getDouble("lng"));

                                Marker m = mMap.addMarker(new MarkerOptions()
                                        .position(pos).title(maneuver)
                                        .icon(BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_GREEN)));
                                turns.add(m);
                            }
                        } catch (JSONException e) {
                            e.printStackTrace();
                        }
                    }
                }, new Response.ErrorListener() {
            @Override
            public void onErrorResponse(VolleyError e) {
                e.printStackTrace();
            }
        });
        stringRequest.setRetryPolicy(new DefaultRetryPolicy(5000,
                DefaultRetryPolicy.DEFAULT_MAX_RETRIES,
                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT));
        queue.add(stringRequest);

    }

    private BitmapDescriptor bitmapDescriptorFromVector(Context context, int vectorResId) {
        Drawable vectorDrawable = ContextCompat.getDrawable(context, vectorResId);
        vectorDrawable.setBounds(0, 0, vectorDrawable.getIntrinsicWidth(), vectorDrawable.getIntrinsicHeight());
        Bitmap bitmap = Bitmap.createBitmap(vectorDrawable.getIntrinsicWidth(), vectorDrawable.getIntrinsicHeight(), Bitmap.Config.ARGB_8888);
        Canvas canvas = new Canvas(bitmap);
        vectorDrawable.draw(canvas);
        return BitmapDescriptorFactory.fromBitmap(bitmap);
    }

    public void runDemoRoute() {
        demoRouteMarkers = new Marker[demoRoute.length];
        for (int i = 0; i < demoRoute.length; i++) {
            double[] xy = demoRoute[i];
            LatLng pos = new LatLng(xy[0], xy[1]);
            Marker m = mMap.addMarker(new MarkerOptions()
                    .position(pos)
                    .icon(bitmapDescriptorFromVector(this, R.drawable.route_dot_24dp))
                    .flat(true));
            demoRouteMarkers[i] = m;
        }

        demoRouteTimer.scheduleAtFixedRate(new TimerTask() {
            @Override
            public void run(){
                final int lastIndex = demoRouteIndex;
                double[] xy = demoRoute[demoRouteIndex++];
                mCurrentLocation = new LatLng(xy[0], xy[1]);
                if (demoRouteIndex >= demoRoute.length) {
                    demoRouteIndex = 0;
                    demoRouteTimer.cancel();
                }


                runOnUiThread(new Runnable() {
                    @Override
                    public void run() {
                        demoRouteMarkers[lastIndex].remove();
                        onLocationUpdated();
                    }
                });
            }
        },0,100);
    }

}
