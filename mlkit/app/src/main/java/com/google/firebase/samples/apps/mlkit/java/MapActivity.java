package com.google.firebase.samples.apps.mlkit.java;

import android.content.Intent;
import androidx.annotation.NonNull;
import androidx.core.content.ContextCompat;
import androidx.fragment.app.FragmentActivity;

import android.content.Context;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.Canvas;
import android.graphics.drawable.Drawable;
import android.location.Location;
import android.media.FaceDetector;
import android.os.Bundle;
import android.speech.tts.TextToSpeech;
import android.util.Log;
import android.view.View;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.fragment.app.FragmentActivity;

import com.android.volley.DefaultRetryPolicy;
import com.android.volley.Request;
import com.android.volley.RequestQueue;
import com.android.volley.Response;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.StringRequest;
import com.android.volley.toolbox.Volley;
import com.google.android.gms.location.FusedLocationProviderClient;
import com.google.android.gms.location.LocationServices;
import com.google.android.gms.maps.CameraUpdateFactory;
import com.google.android.gms.maps.GoogleMap;
import com.google.android.gms.maps.MapView;
import com.google.android.gms.maps.OnMapReadyCallback;
import com.google.android.gms.maps.SupportMapFragment;
import com.google.android.gms.maps.model.BitmapDescriptor;
import com.google.android.gms.maps.model.BitmapDescriptorFactory;
import com.google.android.gms.maps.model.LatLng;
import com.google.android.gms.maps.model.LatLngBounds;
import com.google.android.gms.maps.model.Marker;
import com.google.android.gms.maps.model.MarkerOptions;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.firebase.samples.apps.mlkit.R;
import com.google.firebase.samples.apps.mlkit.common.CameraSource;
import com.google.firebase.samples.apps.mlkit.common.CameraSourcePreview;
import com.google.firebase.samples.apps.mlkit.common.GraphicOverlay;
import com.google.firebase.samples.apps.mlkit.java.facedetection.FaceContourDetectorProcessor;
import com.mikepenz.materialdrawer.Drawer;
import com.mikepenz.materialdrawer.DrawerBuilder;
import com.mikepenz.materialdrawer.model.PrimaryDrawerItem;
import com.mikepenz.materialdrawer.model.interfaces.IDrawerItem;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.IOException;
import java.net.URLEncoder;
import java.util.Locale;

import java.util.Locale;
import java.util.Timer;
import java.util.TimerTask;

public class MapActivity extends FragmentActivity implements OnMapReadyCallback, GoogleMap.OnMyLocationButtonClickListener {
    private final String TAG = "MapActivity";

    private GoogleMap mMap;
    private RequestQueue queue;
    private FusedLocationProviderClient fusedLocationClient;

    private LatLng mCurrentLocation = null;
    private LatLng mLastLocation = null;

    private double[][] demoRoute = {{43.0094622, -81.2727524}, {43.00943493563947, -81.27276165813237}, {43.00940767127894, -81.27277091626475}, {43.0093804069184, -81.27278017439711}, {43.00935314255788, -81.27278943252948}, {43.009325878197345, -81.27279869066186}, {43.00929861383682, -81.27280794879422}, {43.00927134947629, -81.2728172069266}, {43.00924408511575, -81.27282646505897}, {43.00921682075522, -81.27283572319133}, {43.009189556394695, -81.27284498132371}, {43.00916229203416, -81.27285423945607}, {43.009135027673636, -81.27286349758845}, {43.00910776331311, -81.27287275572081}, {43.00908049895257, -81.27288201385319}, {43.009053234592045, -81.27289127198556}, {43.00902597023151, -81.27290053011792}, {43.00899870587099, -81.2729097882503}, {43.00897144151045, -81.27291904638267}, {43.00894417714992, -81.27292830451505}, {43.00891691278939, -81.2729375626474}, {43.00888964842886, -81.27294682077978}, {43.00886238406833, -81.27295607891215}, {43.008835119707804, -81.27296533704452}, {43.00880785534727, -81.27297459517689}, {43.008780590986746, -81.27298385330927}, {43.008753326626206, -81.27299311144162}, {43.00872606226568, -81.27300236957402}, {43.00869879790514, -81.27301162770637}, {43.008671533544614, -81.27302088583875}, {43.00864426918408, -81.27303014397111}, {43.00861700482355, -81.27303940210348}, {43.00858974046302, -81.27304866023584}, {43.0085624761025, -81.27305791836822}, {43.00853521174196, -81.2730671765006}, {43.00850794738143, -81.27307643463297}, {43.008480683020906, -81.27308569276533}, {43.008453418660366, -81.2730949508977}, {43.00842615429984, -81.27310420903008}, {43.00839888993931, -81.27311346716245}, {43.008371625578775, -81.27312272529483}, {43.00834436121825, -81.27313198342719}, {43.008317096857716, -81.27314124155956}, {43.008289832497184, -81.27315049969194}, {43.00826256813666, -81.2731597578243}, {43.008235303776125, -81.27316901595668}, {43.00820803941559, -81.27317827408905}, {43.00818077505507, -81.27318753222141}, {43.00815351069454, -81.27319679035378}, {43.008126246334, -81.27320604848614}, {43.008098981973475, -81.27321530661852}, {43.00807171761294, -81.27322456475089}, {43.00804445325242, -81.27323382288326}, {43.008017188891884, -81.27324308101564}, {43.00798992453135, -81.273252339148}, {43.00796266017082, -81.27326159728038}, {43.00793539581029, -81.27327085541275}, {43.00790813144976, -81.27328011354511}, {43.007880867089234, -81.27328937167749}, {43.007853602728694, -81.27329862980986}, {43.00782633836817, -81.27330788794224}, {43.007799074007636, -81.2733171460746}, {43.007773, -81.273326}, {43.00774441184554, -81.27332943158783}, {43.00771582369109, -81.27333286317565}, {43.007687235536636, -81.27333629476347}, {43.007658647382186, -81.2733397263513}, {43.00763005922772, -81.27334315793912}, {43.007601471073265, -81.27334658952694}, {43.007572882918815, -81.27335002111477}, {43.007544294764365, -81.27335345270261}, {43.00751570660991, -81.27335688429042}, {43.007487118455444, -81.27336031587825}, {43.007458530300994, -81.27336374746608}, {43.007429942146544, -81.2733671790539}, {43.007401353992094, -81.27337061064172}, {43.00737276583763, -81.27337404222953}, {43.00734417768318, -81.27337747381738}, {43.00731558952873, -81.2733809054052}, {43.007287001374266, -81.27338433699302}, {43.007258413219816, -81.27338776858085}, {43.007229825065366, -81.27339120016867}, {43.0072012369109, -81.2733946317565}, {43.00717264875645, -81.27339806334433}, {43.007144060602, -81.27340149493216}, {43.00711547244754, -81.27340492651997}, {43.00708688429309, -81.2734083581078}, {43.00705829613863, -81.27341178969561}, {43.007029707984174, -81.27341522128344}, {43.007001119829724, -81.27341865287127}, {43.00697253167527, -81.2734220844591}, {43.00694394352081, -81.27342551604693}, {43.00691535536636, -81.27342894763476}, {43.0068867672119, -81.27343237922257}, {43.006858179057446, -81.27343581081041}, {43.006829590902996, -81.27343924239823}, {43.00680100274854, -81.27344267398605}, {43.00677241459408, -81.27344610557388}, {43.006743826439624, -81.27344953716171}, {43.006715238285175, -81.27345296874952}, {43.006686650130725, -81.27345640033735}, {43.00665806197627, -81.27345983192518}, {43.00664, -81.273462}, {43.006635329785375, -81.27343358789932}, {43.006630659570746, -81.27340517579862}, {43.006625989356124, -81.27337676369794}, {43.0066213191415, -81.27334835159725}, {43.00661664892688, -81.27331993949656}, {43.00661197871225, -81.27329152739587}, {43.00660730849762, -81.27326311529518}, {43.006602638283, -81.27323470319449}, {43.00659796806837, -81.2732062910938}, {43.00659329785375, -81.27317787899311}, {43.006588627639125, -81.27314946689243}, {43.0065839574245, -81.27312105479174}, {43.006579287209874, -81.27309264269105}, {43.00657461699525, -81.27306423059036}, {43.00656994678063, -81.27303581848967}, {43.006565276566, -81.27300740638898}, {43.00656060635138, -81.27297899428831}, {43.00655593613675, -81.2729505821876}, {43.00655126592213, -81.27292217008693}, {43.006546595707505, -81.27289375798624}, {43.00654192549288, -81.27286534588556}, {43.00653725527825, -81.27283693378486}, {43.00653258506363, -81.27280852168417}, {43.006527914849, -81.27278010958348}, {43.00652324463438, -81.2727516974828}, {43.00651857441975, -81.27272328538211}, {43.00651390420513, -81.27269487328142}, {43.006509233990506, -81.27266646118073}, {43.00650456377588, -81.27263804908006}, {43.006499893561255, -81.27260963697937}, {43.00649522334663, -81.27258122487868}, {43.00649055313201, -81.27255281277799}, {43.00648588291738, -81.2725244006773}, {43.00648121270276, -81.27249598857661}, {43.00647654248813, -81.27246757647592}, {43.00647187227351, -81.27243916437524}, {43.006467202058886, -81.27241075227454}, {43.006462531844264, -81.27238234017386}, {43.006457861629634, -81.27235392807317}, {43.006453191415005, -81.27232551597248}, {43.00644852120038, -81.27229710387181}, {43.00644385098576, -81.27226869177112}, {43.00643918077114, -81.27224027967043}, {43.00643451055651, -81.27221186756974}, {43.00642984034189, -81.27218345546905}, {43.00642517012726, -81.27215504336837}, {43.006420499912636, -81.27212663126767}, {43.006415829698014, -81.27209821916699}, {43.00641115948339, -81.27206980706629}, {43.00640648926876, -81.27204139496561}, {43.00640181905414, -81.27201298286492}, {43.00639714883951, -81.27198457076423}, {43.00639247862489, -81.27195615866354}, {43.00638780841027, -81.27192774656285}, {43.00638313819564, -81.27189933446218}, {43.006378467981015, -81.27187092236147}, {43.006373797766386, -81.2718425102608}, {43.006369127551764, -81.27181409816012}, {43.00636445733714, -81.27178568605942}, {43.00635978712252, -81.27175727395874}, {43.00635511690789, -81.27172886185804}, {43.00635044669326, -81.27170044975736}, {43.00634577647864, -81.27167203765667}, {43.00634110626402, -81.27164362555598}, {43.006336436049395, -81.27161521345529}, {43.00633176583477, -81.2715868013546}, {43.00632709562014, -81.27155838925393}, {43.00632242540552, -81.27152997715322}, {43.00631775519089, -81.27150156505255}, {43.00631308497627, -81.27147315295186}, {43.00630841476165, -81.27144474085117}, {43.00630374454702, -81.27141632875048}, {43.0062990743324, -81.2713879166498}, {43.00629440411777, -81.27135950454911}, {43.006289733903145, -81.27133109244842}, {43.00628506368852, -81.27130268034773}, {43.0062803934739, -81.27127426824704}, {43.00627572325928, -81.27124585614635}, {43.00627105304465, -81.27121744404566}, {43.00626638283003, -81.27118903194497}, {43.0062617126154, -81.2711606198443}, {43.006257042400776, -81.27113220774359}, {43.006252372186154, -81.27110379564292}, {43.006247701971525, -81.27107538354224}, {43.0062430317569, -81.27104697144154}, {43.00623836154227, -81.27101855934086}, {43.00623369132765, -81.27099014724017}, {43.00622902111303, -81.27096173513948}, {43.0062243508984, -81.27093332303879}, {43.00621968068378, -81.2709049109381}, {43.00621501046915, -81.27087649883741}, {43.006210340254526, -81.27084808673673}, {43.006205670039904, -81.27081967463603}, {43.006200999825275, -81.27079126253535}, {43.00619632961065, -81.27076285043466}, {43.00619165939602, -81.27073443833397}, {43.0061869891814, -81.27070602623328}, {43.00618231896678, -81.2706776141326}, {43.00617764875215, -81.2706492020319}, {43.00617297853753, -81.27062078993123}, {43.006168308322906, -81.27059237783052}, {43.006163638108276, -81.27056396572985}, {43.006162, -81.270554}, {43.00618925465599, -81.2705447133377}, {43.00621650931199, -81.2705354266754}, {43.00624376396798, -81.27052614001309}, {43.00627101862398, -81.27051685335078}, {43.00629827327997, -81.27050756668848}, {43.006325527935964, -81.27049828002615}, {43.006352782591954, -81.27048899336386}, {43.00638003724795, -81.27047970670154}, {43.00640729190394, -81.27047042003923}, {43.00643454655993, -81.27046113337693}, {43.006461801215934, -81.27045184671462}, {43.006489055871924, -81.27044256005232}, {43.006516310527914, -81.27043327339}, {43.00654356518391, -81.27042398672769}, {43.0065708198399, -81.2704147000654}, {43.0065980744959, -81.27040541340308}, {43.00662532915189, -81.27039612674076}, {43.00665258380788, -81.27038684007846}, {43.006679838463874, -81.27037755341615}, {43.00670709311987, -81.27036826675385}, {43.00673434777586, -81.27035898009154}, {43.00676160243185, -81.27034969342924}, {43.006788857087855, -81.27034040676693}, {43.006816111743845, -81.27033112010463}, {43.006843366399835, -81.27032183344231}, {43.006870621055825, -81.27031254678}, {43.00689787571183, -81.2703032601177}, {43.00692513036782, -81.27029397345538}, {43.00695238502381, -81.27028468679308}, {43.0069796396798, -81.27027540013077}, {43.0070068943358, -81.27026611346847}, {43.00703414899179, -81.27025682680616}, {43.00706140364778, -81.27024754014386}, {43.00708865830377, -81.27023825348155}, {43.00711591295977, -81.27022896681923}, {43.007143167615766, -81.27021968015693}, {43.007170422271756, -81.27021039349462}, {43.007197676927746, -81.2702011068323}, {43.00722493158374, -81.27019182017}, {43.00725218623974, -81.2701825335077}, {43.00727944089573, -81.27017324684539}, {43.00730669555172, -81.27016396018308}, {43.007333950207716, -81.27015467352078}, {43.007361204863706, -81.27014538685847}, {43.0073884595197, -81.27013610019615}, {43.00741571417569, -81.27012681353385}, {43.00744296883169, -81.27011752687154}, {43.00747022348768, -81.27010824020924}, {43.00749747814368, -81.27009895354692}, {43.007524732799666, -81.27008966688463}, {43.00755198745566, -81.27008038022231}, {43.00757924211165, -81.27007109356}, {43.00760649676765, -81.2700618068977}, {43.00763375142364, -81.2700525202354}, {43.00766100607964, -81.27004323357308}, {43.00768826073563, -81.27003394691077}, {43.007715515391624, -81.27002466024847}, {43.007742770047614, -81.27001537358615}, {43.0077700247036, -81.27000608692386}, {43.0077972793596, -81.26999680026155}, {43.0078245340156, -81.26998751359923}, {43.00785178867159, -81.26997822693693}, {43.00787904332758, -81.26996894027462}, {43.007906297983574, -81.2699596536123}, {43.00793355263957, -81.26995036695}, {43.00796080729556, -81.26994108028771}, {43.00798806195155, -81.26993179362539}, {43.008008, -81.269925}, {43.008003906448664, -81.26989649910163}, {43.007999812897324, -81.26986799820327}, {43.007995719345985, -81.26983949730491}, {43.007991625794645, -81.26981099640655}, {43.00798753224331, -81.26978249550818}, {43.007983438691966, -81.26975399460981}, {43.00797934514063, -81.26972549371146}, {43.007975251589286, -81.26969699281308}, {43.00797115803796, -81.26966849191473}, {43.007967064486614, -81.26963999101636}, {43.00796297093528, -81.269611490118}, {43.00795887738394, -81.26958298921963}, {43.0079547838326, -81.26955448832126}, {43.00795069028126, -81.2695259874229}, {43.00794659672992, -81.26949748652453}, {43.00794250317859, -81.26946898562618}, {43.00793840962725, -81.26944048472781}, {43.00793431607592, -81.26941198382944}, {43.00793022252457, -81.26938348293108}, {43.00792612897324, -81.26935498203272}, {43.0079220354219, -81.26932648113436}, {43.00791794187056, -81.26929798023599}, {43.00791384831922, -81.26926947933761}, {43.00790975476788, -81.26924097843926}, {43.007905661216554, -81.26921247754089}, {43.00790156766521, -81.26918397664252}, {43.007897474113875, -81.26915547574416}, {43.007893380562535, -81.2691269748458}, {43.007889287011196, -81.26909847394744}, {43.007885193459856, -81.26906997304907}, {43.007881099908516, -81.26904147215072}, {43.007877006357184, -81.26901297125235}, {43.007872912805844, -81.26898447035398}, {43.007868819254504, -81.26895596945562}, {43.00786472570317, -81.26892746855725}, {43.00786063215183, -81.26889896765888}, {43.00785653860049, -81.26887046676052}, {43.00785244504915, -81.26884196586215}, {43.00784835149782, -81.26881346496378}, {43.00784425794648, -81.26878496406543}, {43.00784016439514, -81.26875646316707}, {43.0078360708438, -81.2687279622687}, {43.00783197729246, -81.26869946137035}, {43.00782788374113, -81.26867096047198}, {43.00782379018979, -81.26864245957361}, {43.00781969663845, -81.26861395867523}, {43.00781560308711, -81.26858545777688}, {43.00781150953578, -81.26855695687851}, {43.00780741598444, -81.26852845598015}, {43.0078033224331, -81.26849995508178}, {43.007799228881765, -81.26847145418341}, {43.007795135330426, -81.26844295328506}, {43.007791041779086, -81.2684144523867}, {43.007786948227746, -81.26838595148833}, {43.00778285467641, -81.26835745058996}, {43.00777876112507, -81.26832894969161}, {43.007774667573734, -81.26830044879324}, {43.007770574022395, -81.26827194789487}, {43.00776648047106, -81.26824344699651}, {43.00776238691972, -81.26821494609814}, {43.00775829336838, -81.26818644519977}, {43.00775419981704, -81.26815794430141}, {43.0077501062657, -81.26812944340305}, {43.007746012714364, -81.26810094250467}, {43.007741919163024, -81.26807244160632}, {43.00773782561169, -81.26804394070795}, {43.00773373206035, -81.2680154398096}, {43.00772963850902, -81.26798693891124}, {43.00772554495768, -81.26795843801287}, {43.00772145140634, -81.2679299371145}, {43.007717357855, -81.26790143621614}, {43.00771326430366, -81.26787293531777}, {43.00770917075233, -81.2678444344194}, {43.00770507720099, -81.26781593352104}, {43.00770098364965, -81.26778743262267}, {43.00769689009831, -81.26775893172432}, {43.007692796546976, -81.26773043082595}, {43.00768870299564, -81.26770192992758}, {43.0076846094443, -81.26767342902923}, {43.00768051589296, -81.26764492813085}, {43.007676422341625, -81.2676164272325}, {43.007672328790285, -81.26758792633413}, {43.007668235238945, -81.26755942543576}, {43.007664141687606, -81.2675309245374}, {43.00766004813627, -81.26750242363903}, {43.00765595458493, -81.26747392274066}, {43.007651861033594, -81.26744542184231}, {43.007647767482254, -81.26741692094393}, {43.00764367393092, -81.26738842004558}, {43.007639580379575, -81.26735991914721}, {43.00763548682824, -81.26733141824886}, {43.0076313932769, -81.26730291735049}, {43.00762729972557, -81.26727441645211}, {43.00762320617422, -81.26724591555376}, {43.00761911262289, -81.26721741465539}, {43.00761501907155, -81.26718891375702}, {43.00761092552022, -81.26716041285866}, {43.00760683196887, -81.26713191196029}, {43.00760273841754, -81.26710341106194}, {43.007598644866206, -81.26707491016357}, {43.00759455131486, -81.2670464092652}, {43.00759045776353, -81.26701790836684}, {43.00758636421219, -81.26698940746847}, {43.007582270660855, -81.26696090657012}, {43.00757817710951, -81.26693240567174}, {43.007574083558175, -81.26690390477339}, {43.007569990006836, -81.26687540387502}, {43.0075658964555, -81.26684690297667}, {43.007561802904156, -81.26681840207829}, {43.007557709352824, -81.26678990117992}, {43.007556, -81.266778}, {43.00756368536732, -81.26675025124328}, {43.007571370734645, -81.26672250248659}, {43.00757905610197, -81.26669475372987}, {43.00758674146929, -81.26666700497314}, {43.00759442683661, -81.26663925621642}, {43.007602112203934, -81.26661150745971}, {43.007609797571256, -81.26658375870299}, {43.00761748293858, -81.26655600994627}, {43.0076251683059, -81.26652826118956}, {43.00763285367322, -81.26650051243286}, {43.007640539040544, -81.26647276367613}, {43.007648224407866, -81.26644501491943}, {43.00765590977518, -81.26641726616269}, {43.0076635951425, -81.26638951740598}, {43.007671280509825, -81.26636176864928}, {43.007678965877155, -81.26633401989255}, {43.00768665124448, -81.26630627113583}, {43.007694336611806, -81.26627852237912}, {43.00770202197913, -81.26625077362242}, {43.00770970734645, -81.2662230248657}, {43.00771739271377, -81.26619527610897}, {43.00772507808109, -81.26616752735227}, {43.00773276344841, -81.26613977859554}, {43.00774044881573, -81.26611202983882}, {43.00774813418305, -81.26608428108212}, {43.007755819550376, -81.2660565323254}, {43.0077635049177, -81.26602878356869}, {43.00777119028503, -81.26600103481196}, {43.00777887565235, -81.26597328605526}, {43.00778656101967, -81.26594553729853}, {43.007794246386986, -81.26591778854183}, {43.00780193175431, -81.26589003978512}, {43.00780961712163, -81.2658622910284}, {43.00781730248895, -81.26583454227168}, {43.007824987856274, -81.26580679351495}, {43.0078326732236, -81.26577904475825}, {43.00784035859092, -81.26575129600153}, {43.00784804395824, -81.26572354724482}, {43.00785572932556, -81.2656957984881}, {43.007863414692885, -81.26566804973139}, {43.00787110006021, -81.26564030097467}, {43.00787878542753, -81.26561255221796}, {43.00788647079485, -81.26558480346124}, {43.00789415616217, -81.26555705470452}, {43.007901841529495, -81.26552930594781}, {43.007909526896825, -81.26550155719109}, {43.00791721226415, -81.26547380843438}, {43.00792489763147, -81.26544605967766}, {43.00793258299879, -81.26541831092095}, {43.00794026836611, -81.26539056216423}, {43.00794795373343, -81.2653628134075}, {43.00795563910075, -81.2653350646508}, {43.00796332446807, -81.26530731589409}, {43.007971009835394, -81.26527956713737}, {43.007978695202716, -81.26525181838065}, {43.00798638057004, -81.26522406962394}, {43.00799406593736, -81.26519632086722}, {43.00800175130468, -81.26516857211051}, {43.008009436672005, -81.26514082335379}, {43.008017122039334, -81.26511307459708}, {43.00802480740665, -81.26508532584036}, {43.00803249277397, -81.26505757708364}, {43.00804017814129, -81.26502982832693}, {43.008047863508615, -81.26500207957021}, {43.00805554887594, -81.26497433081349}, {43.00806323424326, -81.26494658205678}, {43.00807091961058, -81.26491883330007}, {43.008078604977904, -81.26489108454335}, {43.00808629034523, -81.26486333578664}, {43.00809397571255, -81.26483558702992}, {43.00810166107987, -81.26480783827321}, {43.00810934644719, -81.26478008951649}, {43.008117031814514, -81.26475234075977}, {43.008124717181836, -81.26472459200306}, {43.00813240254916, -81.26469684324634}, {43.00814008791648, -81.26466909448962}, {43.0081477732838, -81.26464134573291}, {43.00815545865113, -81.2646135969762}, {43.008163144018454, -81.26458584821948}, {43.008170829385776, -81.26455809946276}, {43.0081785147531, -81.26453035070605}, {43.00818620012041, -81.26450260194933}, {43.008193885487735, -81.26447485319261}, {43.00820157085506, -81.2644471044359}, {43.00820925622238, -81.2644193556792}, {43.0082169415897, -81.26439160692247}, {43.00822462695703, -81.26436385816575}, {43.00823231232435, -81.26433610940904}, {43.008239997691675, -81.26430836065234}, {43.008247683059, -81.26428061189561}, {43.00825536842632, -81.26425286313889}, {43.008263053793634, -81.26422511438219}, {43.008270739160956, -81.26419736562546}, {43.00827842452828, -81.26416961686874}, {43.0082861098956, -81.26414186811203}, {43.00829379526293, -81.26411411935533}, {43.00830148063025, -81.26408637059859}, {43.008309165997574, -81.26405862184188}, {43.008316851364896, -81.26403087308518}, {43.00832453673222, -81.26400312432847}, {43.00833222209954, -81.26397537557173}, {43.008339907466855, -81.26394762681502}, {43.00834759283418, -81.26391987805832}, {43.0083552782015, -81.2638921293016}, {43.00836296356883, -81.26386438054487}, {43.00837064893615, -81.26383663178817}, {43.00837833430347, -81.26380888303146}, {43.008386019670795, -81.26378113427472}, {43.00839370503812, -81.26375338551802}, {43.00840139040544, -81.26372563676131}, {43.008409075772754, -81.26369788800459}, {43.008416761140076, -81.26367013924786}, {43.0084244465074, -81.26364239049116}, {43.00843213187473, -81.26361464173445}, {43.00843981724205, -81.26358689297773}, {43.00844750260937, -81.263559144221}, {43.00845518797669, -81.2635313954643}, {43.008462873344016, -81.26350364670758}, {43.00847055871134, -81.26347589795085}, {43.00847824407866, -81.26344814919415}, {43.008485929445975, -81.26342040043744}, {43.0084936148133, -81.26339265168072}, {43.008501300180626, -81.263364902924}, {43.00850898554794, -81.26333715416729}, {43.00851667091526, -81.26330940541057}, {43.00852435628259, -81.26328165665386}, {43.008532041649914, -81.26325390789714}, {43.00853972701724, -81.26322615914043}, {43.00854741238456, -81.26319841038371}, {43.008555097751874, -81.26317066162699}, {43.008562783119196, -81.26314291287028}, {43.00857046848652, -81.26311516411356}, {43.00857815385384, -81.26308741535684}, {43.00858583922116, -81.26305966660013}, {43.00859352458849, -81.26303191784342}, {43.00860120995581, -81.2630041690867}, {43.008608895323135, -81.26297642032999}, {43.00861658069046, -81.26294867157327}, {43.00862426605778, -81.26292092281655}, {43.008631951425095, -81.26289317405984}, {43.00863963679242, -81.26286542530312}, {43.00864732215974, -81.26283767654641}, {43.00865500752706, -81.26280992778969}, {43.00866269289439, -81.26278217903297}, {43.00867037826171, -81.26275443027626}, {43.008678063629034, -81.26272668151955}, {43.00868574899635, -81.26269893276283}, {43.00869343436367, -81.26267118400611}, {43.00870111973099, -81.2626434352494}, {43.008708805098316, -81.26261568649268}, {43.00871649046564, -81.26258793773597}, {43.00872417583296, -81.26256018897925}, {43.00873186120029, -81.26253244022254}, {43.00873954656761, -81.26250469146582}, {43.00874723193493, -81.26247694270911}, {43.008754917302255, -81.26244919395239}, {43.00876260266958, -81.26242144519568}, {43.0087702880369, -81.26239369643896}, {43.00877797340422, -81.26236594768224}, {43.008785658771544, -81.26233819892552}, {43.008793344138866, -81.26231045016883}, {43.00880102950619, -81.2622827014121}, {43.00880871487351, -81.26225495265538}, {43.008816400240825, -81.26222720389866}, {43.00882408560815, -81.26219945514194}, {43.00883177097547, -81.26217170638525}, {43.00883945634279, -81.26214395762852}, {43.00884714171011, -81.2621162088718}, {43.008854827077435, -81.2620884601151}, {43.00886251244476, -81.26206071135837}, {43.00887019781208, -81.26203296260165}, {43.00887788317941, -81.26200521384494}, {43.00888556854673, -81.26197746508824}, {43.00889325391405, -81.26194971633151}, {43.008900939281375, -81.26192196757479}, {43.0089086246487, -81.26189421881807}, {43.00891631001602, -81.26186647006138}, {43.00892399538334, -81.26183872130466}, {43.00893168075066, -81.26181097254793}, {43.008939366117986, -81.26178322379121}, {43.00894705148531, -81.2617554750345}, {43.00895473685263, -81.26172772627778}, {43.008962422219945, -81.26169997752108}, {43.00897010758727, -81.26167222876437}, {43.00897779295459, -81.26164448000765}, {43.00898547832191, -81.26161673125092}, {43.00899316368923, -81.2615889824942}, {43.009000849056555, -81.26156123373751}, {43.00900853442388, -81.26153348498079}, {43.0090162197912, -81.26150573622407}, {43.00902390515853, -81.26147798746734}, {43.00903159052585, -81.26145023871064}, {43.00903927589317, -81.26142248995392}, {43.009046961260495, -81.26139474119721}, {43.00905464662782, -81.26136699244049}, {43.00906233199514, -81.26133924368378}, {43.009066, -81.261326}, {43.00904630735112, -81.26130499385923}, {43.00902661470224, -81.26128398771844}, {43.009006922053366, -81.26126298157767}, {43.00898722940448, -81.2612419754369}, {43.0089675367556, -81.26122096929612}, {43.00894784410672, -81.26119996315533}, {43.008928151457845, -81.26117895701458}, {43.00890845880897, -81.2611579508738}, {43.00888876616009, -81.26113694473302}, {43.008869073511214, -81.26111593859224}, {43.00884938086233, -81.26109493245147}, {43.00882968821345, -81.26107392631069}, {43.00880999556457, -81.26105292016992}, {43.0087903029157, -81.26103191402915}, {43.008770610266815, -81.26101090788836}, {43.00875091761794, -81.26098990174759}, {43.008731224969054, -81.26096889560682}, {43.008711532320184, -81.26094788946604}, {43.0086918396713, -81.26092688332527}, {43.00867214702242, -81.26090587718448}, {43.00865245437355, -81.26088487104371}, {43.00863276172466, -81.26086386490294}, {43.008613069075786, -81.26084285876217}, {43.00859337642691, -81.26082185262138}, {43.00857368377803, -81.26080084648062}, {43.00855399112915, -81.26077984033985}, {43.00853429848027, -81.26075883419907}, {43.008514605831394, -81.26073782805828}, {43.00849491318251, -81.26071682191751}, {43.00847522053364, -81.26069581577674}, {43.008455527884756, -81.26067480963596}, {43.00843583523588, -81.26065380349519}, {43.008416142586995, -81.26063279735442}, {43.008396449938125, -81.26061179121365}, {43.00837675728924, -81.26059078507286}, {43.00835706464036, -81.26056977893208}, {43.00833737199149, -81.26054877279131}, {43.00831767934261, -81.26052776665054}, {43.00829798669373, -81.26050676050977}, {43.00827829404484, -81.26048575436899}, {43.008258601395966, -81.26046474822822}, {43.00823890874709, -81.26044374208745}, {43.00821921609821, -81.26042273594666}, {43.00819952344933, -81.26040172980588}, {43.00817983080046, -81.26038072366512}, {43.00816013815158, -81.26035971752435}, {43.0081404455027, -81.26033871138355}, {43.00812075285381, -81.26031770524278}, {43.008101060204936, -81.26029669910201}, {43.00808136755606, -81.26027569296124}, {43.00806167490718, -81.26025468682046}, {43.008041982258305, -81.26023368067968}, {43.00802228960943, -81.2602126745389}, {43.008002596960544, -81.26019166839814}, {43.00798290431167, -81.26017066225737}, {43.00796321166279, -81.2601496561166}, {43.00794351901391, -81.26012864997581}, {43.00792382636503, -81.26010764383503}, {43.00790413371615, -81.26008663769426}, {43.007884441067276, -81.26006563155349}, {43.0078647484184, -81.26004462541272}, {43.007845055769515, -81.26002361927193}, {43.00782536312063, -81.26000261313116}, {43.00780567047176, -81.25998160699038}, {43.00778597782288, -81.25996060084961}, {43.007766285174, -81.25993959470884}, {43.00774659252512, -81.25991858856806}, {43.007726899876246, -81.25989758242727}, {43.00770720722737, -81.2598765762865}, {43.007687514578485, -81.25985557014573}, {43.00766782192961, -81.25983456400496}, {43.00764812928073, -81.25981355786418}, {43.00762843663185, -81.25979255172341}, {43.00760874398297, -81.25977154558264}, {43.007589051334094, -81.25975053944185}, {43.00756935868522, -81.25972953330108}, {43.00754966603633, -81.2597085271603}, {43.00752997338746, -81.25968752101953}, {43.00751028073858, -81.25966651487875}, {43.0074905880897, -81.25964550873798}, {43.00747089544082, -81.2596245025972}, {43.00745120279194, -81.25960349645642}, {43.007431510143064, -81.25958249031565}, {43.00741181749418, -81.25956148417487}, {43.0073921248453, -81.2595404780341}, {43.00737243219643, -81.25951947189333}, {43.00735273954755, -81.25949846575256}, {43.00733304689867, -81.25947745961177}, {43.00731335424979, -81.259456453471}, {43.00729366160091, -81.25943544733022}, {43.007273968952035, -81.25941444118945}, {43.00725427630315, -81.25939343504868}, {43.007234583654274, -81.25937242890791}, {43.00721489100539, -81.25935142276712}, {43.00719519835652, -81.25933041662636}, {43.00717550570764, -81.25930941048559}, {43.00715581305876, -81.2592884043448}, {43.00713612040988, -81.25926739820403}, {43.007116427761005, -81.25924639206326}, {43.00709673511212, -81.25922538592248}, {43.007077042463244, -81.25920437978169}, {43.00705734981436, -81.25918337364092}, {43.007042, -81.259167}, {43.00701659006135, -81.25915345771853}, {43.00699118012269, -81.25913991543705}, {43.00696577018404, -81.25912637315557}, {43.00694036024538, -81.25911283087409}, {43.00691495030672, -81.25909928859261}, {43.00688954036807, -81.25908574631113}, {43.006864130429406, -81.25907220402964}, {43.006838720490755, -81.25905866174816}, {43.006813310552104, -81.25904511946669}, {43.006787900613446, -81.25903157718521}, {43.00676249067479, -81.25901803490372}, {43.006737080736144, -81.25900449262225}, {43.006711670797486, -81.25899095034076}, {43.00668626085883, -81.2589774080593}, {43.00666085092018, -81.2589638657778}, {43.00663544098152, -81.25895032349632}, {43.00661003104287, -81.25893678121484}, {43.00658462110421, -81.25892323893338}, {43.00655921116555, -81.25890969665188}, {43.0065338012269, -81.2588961543704}, {43.00650839128824, -81.25888261208893}, {43.00648298134959, -81.25886906980743}, {43.006457571410934, -81.25885552752597}, {43.00643216147228, -81.25884198524449}, {43.006406751533625, -81.25882844296302}, {43.006381341594974, -81.25881490068153}, {43.006355931656316, -81.25880135840005}, {43.00633052171766, -81.25878781611857}, {43.00630511177901, -81.25877427383709}, {43.00627970184035, -81.25876073155561}, {43.0062542919017, -81.25874718927412}, {43.00622888196304, -81.25873364699265}, {43.00620347202438, -81.25872010471116}, {43.00617806208573, -81.2587065624297}, {43.00615265214708, -81.25869302014821}, {43.00612724220842, -81.25867947786672}, {43.00610183226976, -81.25866593558524}, {43.00607642233111, -81.25865239330376}, {43.00605101239246, -81.2586388510223}, {43.0060256024538, -81.2586253087408}, {43.006000192515145, -81.25861176645932}, {43.00597478257649, -81.25859822417785}, {43.00594937263784, -81.25858468189637}, {43.005923962699185, -81.25857113961489}, {43.00589855276053, -81.25855759733341}, {43.00587314282187, -81.25854405505193}, {43.005847732883225, -81.25853051277045}, {43.00582232294457, -81.25851697048897}, {43.00579691300591, -81.25850342820749}, {43.00577150306725, -81.258489885926}, {43.0057460931286, -81.25847634364453}, {43.00572068318994, -81.25846280136304}, {43.00569527325129, -81.25844925908156}, {43.00566986331263, -81.25843571680008}, {43.005644453373975, -81.25842217451861}, {43.00561904343532, -81.25840863223712}, {43.005593633496666, -81.25839508995564}, {43.005568223558015, -81.25838154767416}, {43.00554281361936, -81.2583680053927}, {43.0055174036807, -81.2583544631112}, {43.00549199374204, -81.25834092082972}, {43.0054665838034, -81.25832737854824}, {43.00544117386474, -81.25831383626678}, {43.00541576392608, -81.25830029398529}, {43.00539035398742, -81.25828675170379}, {43.00536494404877, -81.25827320942233}, {43.00533953411012, -81.25825966714085}, {43.00531412417146, -81.25824612485937}, {43.005288714232805, -81.25823258257788}, {43.005263304294154, -81.25821904029641}, {43.0052378943555, -81.25820549801492}, {43.005212484416845, -81.25819195573345}, {43.00518707447819, -81.25817841345196}, {43.005161664539536, -81.2581648711705}, {43.005136254600885, -81.258151328889}, {43.00511084466223, -81.25813778660753}, {43.00508543472357, -81.25812424432604}, {43.00506002478492, -81.25811070204458}, {43.00503461484626, -81.25809715976308}, {43.00500920490761, -81.2580836174816}, {43.00498379496895, -81.25807007520012}, {43.00495838503029, -81.25805653291864}, {43.00493297509164, -81.25804299063716}, {43.00490756515299, -81.25802944835569}, {43.00488215521433, -81.2580159060742}, {43.004856745275674, -81.25800236379273}, {43.004831335337016, -81.25798882151125}, {43.004805925398365, -81.25797527922977}, {43.004780515459714, -81.25796173694829}, {43.004755105521056, -81.2579481946668}, {43.0047296955824, -81.25793465238533}, {43.00470428564375, -81.25792111010385}, {43.00467887570509, -81.25790756782237}, {43.00465346576644, -81.25789402554089}, {43.00462805582778, -81.25788048325941}, {43.00460264588913, -81.25786694097793}, {43.00457723595047, -81.25785339869645}, {43.00455182601181, -81.25783985641496}, {43.00452641607316, -81.2578263141335}, {43.004501006134504, -81.257812771852}, {43.00447559619585, -81.25779922957052}, {43.004450186257195, -81.25778568728904}, {43.004424776318544, -81.25777214500756}, {43.004399366379886, -81.25775860272608}, {43.00437395644123, -81.25774506044462}, {43.004348546502584, -81.25773151816313}, {43.004323136563926, -81.25771797588165}, {43.00429772662527, -81.25770443360017}, {43.00427231668661, -81.25769089131869}, {43.00424690674796, -81.25767734903721}, {43.00422149680931, -81.25766380675573}, {43.00419608687065, -81.25765026447425}, {43.00417067693199, -81.25763672219277}, {43.00414526699334, -81.25762317991128}, {43.00411985705468, -81.25760963762981}, {43.00409444711603, -81.25759609534832}, {43.00406903717737, -81.25758255306685}, {43.00404362723872, -81.25756901078537}, {43.004018217300064, -81.25755546850388}, {43.003992807361406, -81.25754192622242}, {43.00396739742275, -81.25752838394092}, {43.003941987484104, -81.25751484165946}, {43.003916577545446, -81.25750129937796}, {43.00389116760679, -81.2574877570965}, {43.00386575766813, -81.257474214815}, {43.00384034772948, -81.25746067253353}, {43.00381493779083, -81.25744713025205}, {43.00378952785217, -81.25743358797057}, {43.00376411791351, -81.25742004568909}, {43.00373870797486, -81.25740650340761}, {43.003719, -81.257396}, {43.00372675483839, -81.25736827057789}, {43.00373450967678, -81.25734054115573}, {43.003742264515175, -81.25731281173361}, {43.00375001935356, -81.25728508231147}, {43.00375777419195, -81.25725735288935}, {43.003765529030346, -81.25722962346723}, {43.00377328386874, -81.25720189404508}, {43.00378103870713, -81.25717416462297}, {43.00378879354553, -81.25714643520082}, {43.00379654838392, -81.2571187057787}, {43.00380430322231, -81.25709097635658}, {43.0038120580607, -81.25706324693444}, {43.003819812899096, -81.25703551751232}, {43.00382756773748, -81.25700778809019}, {43.00383532257588, -81.25698005866805}, {43.003843077414274, -81.25695232924593}, {43.00385083225267, -81.25692459982379}, {43.00385858709105, -81.25689687040166}, {43.00386634192945, -81.25686914097955}, {43.00387409676784, -81.2568414115574}, {43.00388185160623, -81.25681368213529}, {43.00388960644462, -81.25678595271314}, {43.003897361283016, -81.25675822329102}, {43.00390511612141, -81.2567304938689}, {43.00391287095981, -81.25670276444676}, {43.003920625798195, -81.25667503502463}, {43.00392838063659, -81.25664730560251}, {43.00393613547497, -81.25661957618037}, {43.00394389031337, -81.25659184675824}, {43.00395164515176, -81.25656411733611}, {43.00395939999015, -81.25653638791398}, {43.00396715482855, -81.25650865849187}, {43.003974909666944, -81.25648092906972}, {43.00398266450533, -81.2564531996476}, {43.00399041934372, -81.25642547022547}, {43.003998174182115, -81.25639774080334}, {43.00400592902051, -81.2563700113812}, {43.0040136838589, -81.25634228195906}, {43.00402143869729, -81.25631455253695}, {43.004029193535686, -81.25628682311482}, {43.00403694837408, -81.25625909369269}, {43.00404470321247, -81.25623136427055}, {43.004052458050865, -81.25620363484842}, {43.00406021288925, -81.2561759054263}, {43.00406796772765, -81.25614817600416}, {43.00407572256604, -81.25612044658203}, {43.004083477404436, -81.25609271715992}, {43.00409123224283, -81.25606498773777}, {43.004098987081214, -81.25603725831564}, {43.00410674191961, -81.25600952889351}, {43.004114496758, -81.2559817994714}, {43.00412225159639, -81.25595407004927}, {43.00413000643478, -81.25592634062713}, {43.00413776127318, -81.255898611205}, {43.00414551611157, -81.25587088178287}, {43.004153270949956, -81.25584315236074}, {43.00416102578835, -81.25581542293861}, {43.00416878062674, -81.25578769351648}, {43.004176535465135, -81.25575996409435}, {43.00418429030353, -81.25573223467222}, {43.00419204514192, -81.2557045052501}, {43.00419979998031, -81.25567677582796}, {43.004207554818706, -81.25564904640584}, {43.0042153096571, -81.2556213169837}, {43.004223064495484, -81.25559358756158}, {43.004230819333884, -81.25556585813945}, {43.00423857417228, -81.25553812871732}, {43.00424632901067, -81.25551039929519}, {43.004254083849055, -81.25548266987306}, {43.004261838687455, -81.25545494045093}, {43.00426959352585, -81.2554272110288}, {43.00427734836423, -81.25539948160667}, {43.004285103202626, -81.25537175218454}, {43.00429285804102, -81.25534402276242}, {43.00430061287942, -81.25531629334029}, {43.004308367717805, -81.25528856391816}, {43.00431612255619, -81.25526083449601}, {43.00432387739459, -81.2552331050739}, {43.00433163223298, -81.25520537565177}, {43.004339387071376, -81.25517764622964}, {43.00434714190976, -81.2551499168075}, {43.004354896748154, -81.25512218738538}, {43.00436265158655, -81.25509445796325}, {43.00437040642494, -81.25506672854112}, {43.00437816126333, -81.255038999119}, {43.004385916101725, -81.25501126969687}, {43.00439367094012, -81.25498354027474}, {43.00440142577851, -81.2549558108526}, {43.0044091806169, -81.25492808143046}, {43.004416935455296, -81.25490035200833}, {43.00442469029369, -81.2548726225862}, {43.00443244513208, -81.25484489316408}, {43.004440199970475, -81.25481716374196}, {43.00444795480887, -81.25478943431983}, {43.00445570964726, -81.2547617048977}, {43.004463464485646, -81.25473397547556}, {43.004471219324046, -81.25470624605343}, {43.00447897416243, -81.2546785166313}, {43.004486729000824, -81.25465078720917}, {43.00449448383922, -81.25462305778704}, {43.00450223867761, -81.25459532836491}, {43.004509993516, -81.25456759894278}, {43.00451774835439, -81.25453986952066}, {43.00452550319278, -81.25451214009853}, {43.00453325803118, -81.25448441067638}, {43.004541012869566, -81.25445668125425}, {43.00454876770796, -81.25442895183212}, {43.00455652254635, -81.25440122241}, {43.004564277384745, -81.25437349298788}, {43.00457203222314, -81.25434576356575}, {43.00457978706153, -81.25431803414362}, {43.00458754189992, -81.2542903047215}, {43.004595296738316, -81.25426257529936}, {43.00460305157671, -81.25423484587722}, {43.0046108064151, -81.25420711645509}, {43.004618561253494, -81.25417938703296}, {43.00462631609189, -81.25415165761083}, {43.00463407093028, -81.2541239281887}, {43.004641825768665, -81.25409619876658}, {43.004649580607065, -81.25406846934445}, {43.00465733544546, -81.25404073992232}, {43.004665090283844, -81.25401301050019}, {43.004672845122236, -81.25398528107806}, {43.00468059996063, -81.25395755165593}, {43.00468835479902, -81.2539298222338}, {43.004696109637415, -81.25390209281167}, {43.00470386447581, -81.25387436338954}, {43.0047116193142, -81.25384663396741}, {43.00471937415259, -81.25381890454528}, {43.00472712899098, -81.25379117512315}, {43.00473488382937, -81.25376344570103}, {43.004742638667764, -81.2537357162789}, {43.00475039350616, -81.25370798685677}, {43.00475814834455, -81.25368025743464}, {43.00476590318294, -81.25365252801251}, {43.004773658021335, -81.25362479859038}, {43.00478141285973, -81.25359706916825}, {43.00478916769812, -81.25356933974612}, {43.004796922536514, -81.25354161032399}, {43.004804677374906, -81.25351388090186}, {43.0048124322133, -81.25348615147973}, {43.00482018705169, -81.2534584220576}, {43.00482794189008, -81.25343069263548}, {43.00483569672847, -81.25340296321335}, {43.00484345156686, -81.25337523379122}, {43.00485120640526, -81.25334750436907}, {43.004858961243656, -81.25331977494696}, {43.00486671608204, -81.25329204552482}, {43.004874470920434, -81.2532643161027}, {43.00488222575883, -81.25323658668056}, {43.00488998059722, -81.25320885725844}, {43.004897735435605, -81.2531811278363}, {43.004905490274, -81.25315339841418}, {43.0049132451124, -81.25312566899204}, {43.00492099995079, -81.25309793956991}, {43.004928754789184, -81.25307021014778}, {43.00493650962757, -81.25304248072565}, {43.00494426446596, -81.25301475130352}, {43.004952019304355, -81.2529870218814}, {43.00495977414275, -81.25295929245927}, {43.00496752898115, -81.25293156303714}, {43.00497528381953, -81.25290383361502}, {43.004983038657926, -81.25287610419288}, {43.00499079349632, -81.25284837477075}, {43.00499854833471, -81.25282064534862}, {43.005006303173104, -81.25279291592649}, {43.00501405801149, -81.25276518650436}, {43.00502181284988, -81.25273745708223}, {43.00502956768828, -81.2527097276601}, {43.005037322526675, -81.25268199823797}, {43.00504507736506, -81.25265426881585}, {43.005052832203454, -81.25262653939372}, {43.00506058704185, -81.25259880997157}, {43.00506834188024, -81.25257108054946}, {43.00507609671863, -81.25254335112731}, {43.00508385155702, -81.2525156217052}, {43.00509160639542, -81.25248789228306}, {43.00509936123381, -81.25246016286094}, {43.005105, -81.25244}, {43.00507965177574, -81.25242634255159}, {43.00505430355149, -81.25241268510318}, {43.005028955327234, -81.25239902765476}, {43.00500360710298, -81.25238537020635}, {43.00497825887872, -81.25237171275793}, {43.00495291065447, -81.25235805530951}, {43.00492756243021, -81.2523443978611}, {43.004902214205956, -81.25233074041269}, {43.0048768659817, -81.25231708296427}, {43.004873, -81.252315}};
    private int demoRouteIndex = 0;
    private Timer demoRouteTimer;

    private Marker[] demoRouteMarkers;

    public static FaceContourDetectorProcessor faceProcessor;
    public static CameraSource cameraSource = null;
    private static final String FACE_CONTOUR = "Face Contour";
    private CameraSourcePreview preview;
    private GraphicOverlay graphicOverlay;

    private MapView mapView;

    TextToSpeech t1;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_map);

//        mapView = findViewById(R.id.map);
//        FragmentManager fm = getFragmentManager();
//        fm.beginTransaction()
//                .setCustomAnimations(android.R.animator.fade_in, android.R.animator.fade_out)
//                .show(somefrag)
//                .commit();
//        mapView.setVisibility(View.INVISIBLE);

        //if you want to update the items at a later time it is recommended to keep it in a variable
        PrimaryDrawerItem reminders= new PrimaryDrawerItem().withIdentifier(0).withName("Reminders Before");
        PrimaryDrawerItem frequency = new PrimaryDrawerItem().withIdentifier(1).withName("Frequency");
        PrimaryDrawerItem feedback = new PrimaryDrawerItem().withIdentifier(2).withName("Feedback after");
        PrimaryDrawerItem camera = new PrimaryDrawerItem().withIdentifier(3).withName("Camera");



        //create the drawer and remember the `Drawer` result object
        Drawer result = new DrawerBuilder()
                .withActivity(this)
                //.withToolbar(toolbar)
                .withActionBarDrawerToggle(true)
                .withActionBarDrawerToggleAnimated(true)
                .withCloseOnClick(true)
                .withSelectedItem(-1)
                .addDrawerItems(
                        reminders,
                        frequency,
                        feedback,
                        camera
                )

                .withOnDrawerItemClickListener(new Drawer.OnDrawerItemClickListener() {
                    @Override
                    public boolean onItemClick(View view, int position, IDrawerItem drawerItem) {
                        if (drawerItem.getIdentifier() == 3) {
                            if (preview.getVisibility() == View.INVISIBLE) {
                                preview.setVisibility(View.VISIBLE);
                                graphicOverlay.setVisibility(View.VISIBLE);
                            } else {
                                preview.setVisibility(View.INVISIBLE);
                                graphicOverlay.setVisibility(View.INVISIBLE);
                            }
//                            Intent intent = new Intent(getBaseContext(), LivePreviewActivity.class);
//                            view.getContext().startActivity(intent);
                        }
                        return true;
                    }

                })
                .build();

        // Obtain the SupportMapFragment and get notified when the map is ready to be used.
        SupportMapFragment mapFragment = (SupportMapFragment) getSupportFragmentManager()
                .findFragmentById(R.id.map);
        mapFragment.getMapAsync(this);

        // Instantiate the RequestQueue.
        queue = Volley.newRequestQueue(this);

        fusedLocationClient = LocationServices.getFusedLocationProviderClient(this);

        demoRouteTimer = new Timer();

        t1=new TextToSpeech(getApplicationContext(), new TextToSpeech.OnInitListener() {
            @Override
            public void onInit(int status) {
                if(status != TextToSpeech.ERROR) {
                    t1.setLanguage(Locale.US);
                }
            }
        });
        faceProcessor = new FaceContourDetectorProcessor(t1);

        preview = findViewById(R.id.firePreview);
        if (preview == null) {
            Log.d(TAG, "Preview is null");
        }
        preview.setVisibility(View.INVISIBLE);
        graphicOverlay = findViewById(R.id.fireFaceOverlay);

        Log.d(TAG, "this is it overlay: " + graphicOverlay);
        if (graphicOverlay == null) {
            Log.d(TAG, "graphicOverlay is null");
        }
        graphicOverlay.setVisibility(View.INVISIBLE);


        createCameraSource("Face Contour");
        cameraSource.setFacing(CameraSource.CAMERA_FACING_FRONT);
        startCameraSource();
    }

    private void startCameraSource() {
        if (cameraSource != null) {
            try {
                if (preview == null) {
                    Log.d(TAG, "resume: Preview is null");
                }
                if (graphicOverlay == null) {
                    Log.d(TAG, "resume: graphOverlay is null");
                }
                preview.start(cameraSource, graphicOverlay);
            } catch (IOException e) {
                Log.e(TAG, "Unable to start camera source.", e);
                cameraSource.release();
                cameraSource = null;
            }
        }
    }

    private void createCameraSource(String model) {
        // If there's no existing cameraSource, create one.
        if (cameraSource == null) {
            cameraSource = new CameraSource(this, graphicOverlay);
        }

        try {
            switch (model) {
                case FACE_CONTOUR:
                    Log.i(TAG, "Using Face Contour Detector Processor");
                    cameraSource.setMachineLearningFrameProcessor(faceProcessor);
                    break;
                default:
                    Log.e(TAG, "Unknown model: " + model);
            }
        } catch (Exception e) {
            Log.e(TAG, "Can not create image processor: " + model, e);
            Toast.makeText(
                    getApplicationContext(),
                    "Can not create image processor: " + e.getMessage(),
                    Toast.LENGTH_LONG)
                    .show();
        }
    }

    @Override
    public void onMapReady(GoogleMap googleMap) {
        mMap = googleMap;

        // TODO: Before enabling the My Location layer, you must request
        // location permission from the user. This sample does not include
        // a request for location permission.
        mMap.setMyLocationEnabled(true);
        mMap.setOnMyLocationButtonClickListener(this);


        String url = "https://maps.london.ca/arcgisa/rest/services/OpenData/OpenData_Transportation/MapServer/16/query?where=1%3D1&outFields=*&outSR=4326&f=json";
        StringRequest stringRequest = new StringRequest(Request.Method.GET, url,
                new Response.Listener<String>() {
                    @Override
                    public void onResponse(String response) {
                        try {
                            JSONObject json = new JSONObject(response);
                            JSONArray features = json.getJSONArray("features");
                            for (int i = 0; i < features.length(); i++) {
                                JSONObject f = features.getJSONObject(i);
                                String type = f.getJSONObject("attributes").getString("IntersectionType");
                                double x = f.getJSONObject("geometry").getDouble("x");
                                double y = f.getJSONObject("geometry").getDouble("y");

                                LatLng pos = new LatLng(y, x);
                                mMap.addMarker(new MarkerOptions().position(pos).title(type));
                            }
                        } catch (JSONException e) {
                            e.printStackTrace();
                        }
                    }
                }, new Response.ErrorListener() {
                    @Override
                    public void onErrorResponse(VolleyError e) {
                        e.printStackTrace();
                    }
                });
        stringRequest.setRetryPolicy(new DefaultRetryPolicy(5000,
                DefaultRetryPolicy.DEFAULT_MAX_RETRIES,
                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT));
        queue.add(stringRequest);
    }

    @Override
    public void onResume() {
        super.onResume();
        fusedLocationClient.getLastLocation()
                .addOnSuccessListener(this, new OnSuccessListener<Location>() {
                    @Override
                    public void onSuccess(Location location) {
                        if (location != null) {
                            mLastLocation = mCurrentLocation;
                            mCurrentLocation = new LatLng(location.getLatitude(), location.getLongitude());
                            mMap.moveCamera(CameraUpdateFactory.newLatLngZoom(
                                    mCurrentLocation, 15));
                        }
                    }
                })
                .addOnFailureListener(this, new OnFailureListener() {
                    @Override
                    public void onFailure(@NonNull Exception e) {
                        Log.e(TAG, "Failed to get location: ", e);
                    }
                });
    }

    @Override
    public boolean onMyLocationButtonClick() {
        runDemoRoute();

        setDestination("Ryerson Public School");

        // Return false so that we don't consume the event and the default behavior still occurs
        // (the camera animates to the user's current position).
        return false;
    }

    public void setDestination(String destination) {
        String url = String.format(Locale.US,
                "https://maps.googleapis.com/maps/api/directions/json?origin=%.6f,%.6f&destination=%s&key=%s&mode=driving&avoid=tolls|highways|ferries&region=ca",
                mCurrentLocation.latitude,
                mCurrentLocation.longitude,
                URLEncoder.encode(destination),
                getString(R.string.google_maps_key));
        StringRequest stringRequest = new StringRequest(Request.Method.GET, url,
                new Response.Listener<String>() {
                    @Override
                    public void onResponse(String response) {
                        try {
                            Log.i(TAG, "ROUTE RESPONSE:");
                            Log.i(TAG, response);

                            JSONObject route = new JSONObject(response)
                                    .getJSONArray("routes")
                                    .getJSONObject(0);

                            JSONObject neCorner = route.getJSONObject("bounds").getJSONObject("northeast");
                            JSONObject swCorner = route.getJSONObject("bounds").getJSONObject("southwest");

                            LatLngBounds bounds = new LatLngBounds(
                                    new LatLng(swCorner.getDouble("lat"), swCorner.getDouble("lng")),
                                    new LatLng(neCorner.getDouble("lat"), neCorner.getDouble("lng")));

                                    mMap.moveCamera(CameraUpdateFactory.newLatLngBounds(bounds, 0));

                            JSONArray steps = route
                                    .getJSONArray("legs")
                                    .getJSONObject(0)
                                    .getJSONArray("steps");

                            for (int i = 0; i < steps.length(); i++) {
                                JSONObject step = steps.getJSONObject(i);
                                String maneuver = step.optString("maneuver", "no-maneuver");

                                JSONObject location = step.getJSONObject("start_location");
                                LatLng pos = new LatLng(location.getDouble("lat"), location.getDouble("lng"));

                                mMap.addMarker(new MarkerOptions()
                                        .position(pos).title(maneuver)
                                        .icon(BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_GREEN)));
                            }
                        } catch (JSONException e) {
                            e.printStackTrace();
                        }
                    }
                }, new Response.ErrorListener() {
            @Override
            public void onErrorResponse(VolleyError e) {
                e.printStackTrace();
            }
        });
        stringRequest.setRetryPolicy(new DefaultRetryPolicy(5000,
                DefaultRetryPolicy.DEFAULT_MAX_RETRIES,
                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT));
        queue.add(stringRequest);

    }

    private BitmapDescriptor bitmapDescriptorFromVector(Context context, int vectorResId) {
        Drawable vectorDrawable = ContextCompat.getDrawable(context, vectorResId);
        vectorDrawable.setBounds(0, 0, vectorDrawable.getIntrinsicWidth(), vectorDrawable.getIntrinsicHeight());
        Bitmap bitmap = Bitmap.createBitmap(vectorDrawable.getIntrinsicWidth(), vectorDrawable.getIntrinsicHeight(), Bitmap.Config.ARGB_8888);
        Canvas canvas = new Canvas(bitmap);
        vectorDrawable.draw(canvas);
        return BitmapDescriptorFactory.fromBitmap(bitmap);
    }


    public void runDemoRoute() {
        demoRouteMarkers = new Marker[demoRoute.length];
        for (int i = 0; i < demoRoute.length; i++) {
            double[] xy = demoRoute[i];
            LatLng pos = new LatLng(xy[0], xy[1]);
            Marker m = mMap.addMarker(new MarkerOptions()
                    .position(pos)
                    .icon(bitmapDescriptorFromVector(this, R.drawable.route_dot_24dp)));
            demoRouteMarkers[i] = m;
        }

        demoRouteTimer.scheduleAtFixedRate(new TimerTask() {
            @Override
            public void run(){
                final int lastIndex = demoRouteIndex;
                double[] xy = demoRoute[demoRouteIndex++];
                LatLng pos = new LatLng(xy[0], xy[1]);
                mCurrentLocation = pos;
                if (demoRouteIndex >= demoRoute.length) {
                    demoRouteTimer.cancel();
                    demoRouteIndex = 0;
                }
                runOnUiThread(new Runnable() {
                    @Override
                    public void run() {
                        demoRouteMarkers[lastIndex].remove();
                    }
                });
            }
        },0,100);
    }

}
